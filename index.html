<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>PASOVART Y√∂netim Paneli</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f0f4f8;--card:#fff;--sb:#1e293b;--sb2:#0f172a;
  --acc:#3b82f6;--acc2:#60a5fa;
  --txt:#1e293b;--txt2:#475569;--txt3:#94a3b8;
  --bdr:#f1f5f9;--bdr2:#e2e8f0;
  --grn:#10b981;--grn-bg:#ecfdf5;
  --red:#ef4444;--red-bg:#fef2f2;--red-l:#fee2e2;
  --amb:#f59e0b;--amb-bg:#fffbeb;
  --pur:#7c3aed;--pur-bg:#ede9fe;
  --blu:#0284c7;--blu-bg:#e0f2fe;
  --sh:0 2px 14px rgba(0,0,0,.07);
  --fn:'DM Sans',system-ui,sans-serif;
  --sb-width: 250px;
}
html,body{height:100%;font-family:var(--fn);background:var(--bg);color:var(--txt)}

/* ‚îÄ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ‚îÄ */
.app{display:flex;height:100vh;overflow:hidden}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.sb{
  width:var(--sb-width);flex-shrink:0;
  background:linear-gradient(180deg,var(--sb),var(--sb2));
  color:#fff;display:flex;flex-direction:column;
  box-shadow:2px 0 12px rgba(0,0,0,.12);
  position:relative;z-index:20;transition:transform .3s ease;
}
.sb-logo{
  padding:24px 20px 20px;
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;gap:12px;
}
.sb-logo-icon{
  width:42px;height:42px;border-radius:12px;
  background:linear-gradient(135deg,#2563eb,#60a5fa);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 3px 10px rgba(37,99,235,.35);
}
.sb-logo-txt strong{font-size:18px;font-weight:800;letter-spacing:-.4px;display:block}
.sb-logo-txt em{font-size:10px;color:rgba(255,255,255,.4);font-style:normal;font-weight:500}
.sb-nav{flex:1;padding:14px 12px;overflow-y:auto}

.nav-item{
  width:100%;display:flex;align-items:center;gap:11px;
  padding:11px 14px;border-radius:10px;border:none;
  background:transparent;color:rgba(255,255,255,.52);
  font:500 14px/1 var(--fn);cursor:pointer;
  transition:all .18s;margin-bottom:3px;position:relative;
  text-align:left;text-decoration:none;
}
.nav-item:hover{background:rgba(255,255,255,.08);color:rgba(255,255,255,.88)}
.nav-item.active{background:rgba(59,130,246,.2);color:var(--acc2);font-weight:700}
.nav-item.active::after{
  content:'';position:absolute;right:14px;top:50%;transform:translateY(-50%);
  width:7px;height:7px;border-radius:50%;background:var(--acc2);
}
.nav-item svg{flex-shrink:0;width:19px;height:19px}

/* Submenu */
.submenu{max-height:0;overflow:hidden;transition:max-height 0.3s ease;padding-left:20px}
.nav-item.has-sub.open + .submenu { max-height:200px }
.nav-item.has-sub::before{
  content:'';position:absolute;right:14px;top:50%;transform:translateY(-50%) rotate(0deg);
  width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;
  border-top:5px solid rgba(255,255,255,.52);transition:transform .2s;
}
.nav-item.has-sub.open::before{transform:translateY(-50%) rotate(180deg)}

.sb-footer{
  padding:16px 20px;
  border-top:1px solid rgba(255,255,255,.07);
  font-size:11px;color:rgba(255,255,255,.25);
  display:flex;justify-content:space-between;align-items:center;
}
.sb-status{display:flex;align-items:center;gap:6px}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--grn)}
.status-dot.offline{background:#94a3b8}
.status-dot.connecting{background:var(--amb);animation:pulse 1.2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;position:relative}
.hdr{
  background:var(--card);padding:12px 20px;
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid var(--bdr);flex-shrink:0;
  box-shadow:0 1px 4px rgba(0,0,0,.04);
}
.hdr-left{display:flex;align-items:center;gap:15px}
.menu-btn{display:none;background:none;border:none;cursor:pointer;color:var(--txt)}
.hdr-search{display:flex;align-items:center;gap:8px;background:#f8fafc;border-radius:10px;padding:9px 15px}
.hdr-search input{border:none;outline:none;background:transparent;font:400 14px var(--fn);color:var(--txt2);width:180px}
.hdr-right{display:flex;align-items:center;gap:14px}
.hdr-greet{font-size:13px;color:var(--txt3)}
.hdr-avatar{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#2563eb,#60a5fa);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:15px}
.content{flex:1;overflow-y:auto;padding:26px 28px;position:relative}

/* ‚îÄ‚îÄ‚îÄ PAGES & UI ‚îÄ‚îÄ‚îÄ */
.pg{display:none;animation:fadeUp .28s ease}.pg.on{display:block}
.ph{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
.ph h2{font-size:21px;font-weight:800;color:var(--txt)}

.btn{
  display:inline-flex;align-items:center;gap:6px;
  border:none;border-radius:10px;padding:9px 18px;
  font:600 14px var(--fn);cursor:pointer;
  transition:transform .12s,box-shadow .12s;white-space:nowrap;
}
.btn:active{transform:scale(.96)}
.btn-p{background:linear-gradient(135deg,#1e40af,var(--acc));color:#fff;box-shadow:0 2px 8px rgba(59,130,246,.3)}
.btn-g{background:#f1f5f9;color:var(--txt2)}.btn-g:hover{background:var(--bdr2)}
.btn-d{background:var(--red-l);color:var(--red)}.btn-d:hover{background:#fecaca}
.btn-e{background:#eef2ff;color:#4f46e5}.btn-e:hover{background:#e0e7ff}
.btn-sm{padding:5px 9px;font-size:12px;border-radius:8px}

.card{background:var(--card);border-radius:14px;box-shadow:var(--sh);border:1px solid var(--bdr)}
.card-p{padding:22px}
.badge{display:inline-block;padding:3px 11px;border-radius:20px;font-size:12px;font-weight:600;white-space:nowrap}
.b-upcoming{background:var(--blu-bg);color:var(--blu)}
.b-done,.b-completed,.b-active,.b-signed{background:var(--grn-bg);color:var(--grn)}
.b-inprogress,.b-pending{background:var(--amb-bg);color:var(--amb)}
.b-todo{background:var(--pur-bg);color:var(--pur)}

.stat-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:14px;margin-bottom:22px}
.stat{padding:18px 19px;display:flex;align-items:center;gap:15px;cursor:default;}
.stat.clickable { cursor:pointer; transition:transform 0.1s; }
.stat.clickable:active { transform:scale(0.98); }

.stat-ico{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.stat-lbl{font-size:11px;color:var(--txt3);font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.stat-val{font-size:21px;font-weight:800;margin-top:2px}

.tbl-wrap{border-radius:14px;border:1px solid var(--bdr);box-shadow:var(--sh);overflow-x:auto}
table{width:100%;border-collapse:collapse;background:var(--card)}
thead tr{background:#f8fafc}
th{padding:11px 14px;text-align:left;font-size:11px;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--bdr);white-space:nowrap}
td{padding:12px 14px;font-size:13px;color:var(--txt2);border-bottom:1px solid #fafafa;white-space:nowrap}
tr:last-child td{border-bottom:none}

.cl-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:15px}
.cl-card{padding:19px}
.cl-head{display:flex;justify-content:space-between;align-items:flex-start}
.cl-ava{width:43px;height:43px;border-radius:12px;background:linear-gradient(135deg,#dbeafe,#bfdbfe);display:flex;align-items:center;justify-content:center}

/* KANBAN */
.kanban{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:15px}
.kb-col{background:#f8fafc;border-radius:14px;padding:15px;border:1px solid var(--bdr)}
.kb-head{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.kb-cards{display:flex;flex-direction:column;gap:9px}
.kb-card{background:var(--card);border-radius:11px;padding:13px;box-shadow:0 2px 8px rgba(0,0,0,.05);border:1px solid var(--bdr)}

/* MOBILE */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:15;opacity:0;pointer-events:none;transition:opacity .3s}
.overlay.active{opacity:1;pointer-events:all}
@media (max-width: 768px) {
  .app{flex-direction:column}
  .sb{position:fixed;top:0;left:0;bottom:0;transform:translateX(-100%)}
  .sb.active{transform:translateX(0)}
  .menu-btn{display:block}
  .content{padding:15px}
  .hdr-search{display:none}
}

/* MODAL & TOAST */
.mo{position:fixed;inset:0;background:rgba(0,0,0,.38);backdrop-filter:blur(5px);z-index:999;display:none;align-items:center;justify-content:center}
.mo.on{display:flex}
.mo-box{background:#fff;border-radius:16px;width:90%;max-width:470px;max-height:90vh;overflow-y:auto;padding:30px;box-shadow:0 30px 70px rgba(0,0,0,.2)}
.mo-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:22px}
.mo-cls{border:none;background:#f1f5f9;border-radius:8px;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.fg{margin-bottom:15px}
.fg label{display:block;font-size:13px;font-weight:600;color:var(--txt2);margin-bottom:5px}
.fg input,.fg select,.fg textarea{width:100%;padding:9px 13px;border:1.5px solid var(--bdr2);border-radius:10px;font:400 14px var(--fn);background:#fafafa;color:var(--txt);outline:none;transition:border .2s}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--acc);background:#fff}
.fg textarea{resize:vertical;min-height:80px}
.fr{display:flex;gap:11px}.fr .fg{flex:1}
.f-sub{width:100%;padding:11px;margin-top:6px;font-size:15px}
.section-title { font-size:12px; font-weight:700; color:var(--acc); text-transform:uppercase; margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid #f1f5f9; margin-top:15px; }

/* Detail View Styles */
.det-row { display:flex; margin-bottom:12px; border-bottom:1px solid #f1f5f9; padding-bottom:8px; }
.det-lbl { width:120px; font-weight:600; color:var(--txt3); font-size:13px; }
.det-val { flex:1; font-weight:500; color:var(--txt); font-size:14px; }
.click-row { cursor:pointer; transition:background .15s; }
.click-row:hover { background: #f8fafc; }

/* ‚îÄ‚îÄ‚îÄ YENƒ∞ S√ñZLE≈ûME VE PRINT MODAL STƒ∞LLERƒ∞ ‚îÄ‚îÄ‚îÄ */
.print-modal {
    display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%;
    overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
}
.print-modal-content {
    background-color: #fff; margin: 3% auto; padding: 30px; border-radius: 16px;
    width: 90%; max-width: 800px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    position: relative;
}
.close-print-btn {
    position: absolute; top: 15px; right: 20px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; z-index: 10;
}
.close-print-btn:hover { color: #000; }

/* S√∂zle≈üme ƒ∞√ßerik Stilleri (Admin) */
.ct-print-area { padding: 10px; }
.ct-header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; }
.ct-logo { font-size: 20px; font-weight: 800; color: #000; }
.ct-logo span { display: block; font-size: 12px; font-weight: 500; color: #555; }

.ct-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ccc; padding-bottom: 8px; margin-bottom: 8px; }
.ct-row:last-child { border-bottom: none; }

.ct-lbl { color: #555; font-size: 13px; font-weight: 700; width: 40%; }
.ct-val { color: #000; font-size: 14px; font-weight: 600; text-align: right; width: 60%; }

.ct-box { border: 1px solid #000; padding: 15px; margin-top: 20px; }
.ct-title { font-size: 14px; font-weight: 800; color: #000; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
.ct-text { font-size: 13px; color: #000; line-height: 1.6; white-space: pre-line; text-align: justify; }

/* Print Butonu */
.admin-print-btn {
    display: block; width: 100%; background: var(--sb); color: #fff; padding: 12px; 
    border: none; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 20px;
}
.admin-print-btn:hover { background: var(--sb2); }

/* Print Media Query */
@media print {
    body * { visibility: hidden; }
    .print-modal { position: absolute; left: 0; top: 0; width: 100%; height: auto; background: #fff; overflow: visible; display: block !important; }
    .print-modal-content { box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 0; }
    .ct-print-area, .ct-print-area * { visibility: visible; }
    .ct-print-area { position: absolute; left: 0; top: 0; width: 100%; }
    .admin-print-btn, .close-print-btn { display: none !important; }
}

.toast{position:fixed;bottom:24px;right:24px;z-index:1001;background:var(--txt);color:#fff;padding:12px 20px;border-radius:12px;font:500 14px var(--fn);opacity:0;transform:translateY(12px);transition:all .3s;pointer-events:none;max-width:320px}
.toast.on{opacity:1;transform:translateY(0)}
.toast.success{background:var(--grn)}
.toast.error{background:var(--red)}

/* LOGIN SCREEN */
.login-screen{position:fixed;inset:0;background:linear-gradient(135deg,var(--sb),var(--sb2));z-index:9999;display:flex;align-items:center;justify-content:center}
.login-box{background:#fff;border-radius:20px;padding:40px;width:90%;max-width:400px;box-shadow:0 30px 80px rgba(0,0,0,.3)}
.login-logo{text-align:center;margin-bottom:30px}
.login-logo-icon{width:60px;height:60px;border-radius:16px;background:linear-gradient(135deg,#2563eb,#60a5fa);display:inline-flex;align-items:center;justify-content:center;box-shadow:0 5px 15px rgba(37,99,235,.4);margin-bottom:12px}

@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
</style>
</head>
<body>

<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div>
      <strong>PASOVART</strong>
      <em>Y√∂netici Giri≈üi</em>
    </div>
    <div class="fg"><label>Kullanƒ±cƒ± Adƒ±</label><input type="text" id="loginUser" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z"/></div>
    <div class="fg"><label>≈ûifre</label><input type="password" id="loginPass" placeholder="≈ûifreniz" onkeypress="if(event.key==='Enter')doLogin()"/></div>
    <button class="btn btn-p f-sub" onclick="doLogin()">Giri≈ü Yap</button>
    <div id="loginError" style="color:var(--red);font-size:12px;margin-top:10px;text-align:center;display:none"></div>
  </div>
</div>

<div class="app" style="display:none" id="mainApp">
<div class="overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<aside class="sb" id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-icon"><svg width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div>
    <div class="sb-logo-txt"><strong>PASOVART</strong><em>Y√∂netim Paneli</em></div>
  </div>
  <nav class="sb-nav">
    <button class="nav-item active" data-tab="dashboard">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Ana √ñzet
    </button>
    <button class="nav-item" data-tab="sessions">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      √áekimler
    </button>
    <button class="nav-item" data-tab="clients">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="7" r="4"/><path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/><circle cx="17" cy="9" r="2.5"/><path d="M23 21v-1.5a3 3 0 0 0-3-3h-.5"/></svg>
      M√º≈üteriler
    </button>
    <button class="nav-item" data-tab="client-auth">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
      M√º≈üteri Giri≈üleri
    </button>
    
    <button class="nav-item" data-tab="panel-mgmt" style="background:rgba(255,255,255,0.05); color:#fff; border:1px solid rgba(255,255,255,0.1)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      Panel Y√∂netimi
    </button>

    <button class="nav-item" data-tab="tasks">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
      G√∂revler
    </button>
    <button class="nav-item" data-tab="contracts">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      S√∂zle≈ümeler
    </button>
    <button class="nav-item" data-tab="finance">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      Gelir / Gider
    </button>
    <button class="nav-item has-sub" onclick="toggleSub(event)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      D√ºkkanlar
    </button>
    <div class="submenu">
      <button class="nav-item" data-tab="store-corlu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>√áorlu</button>
      <button class="nav-item" data-tab="store-ergene"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>Ergene</button>
    </div>
  </nav>
  <div class="sb-footer">
    <span>PASOVART v3.0</span>
    <div class="sb-status"><div class="status-dot connecting" id="statusDot"></div><span id="statusTxt">Baƒülanƒ±yor‚Ä¶</span></div>
  </div>
</aside>

<div class="main">
  <header class="hdr">
    <div class="hdr-left">
      <button class="menu-btn" onclick="toggleSidebar()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1e293b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
      <div class="hdr-search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" placeholder="Arama‚Ä¶" /></div>
    </div>
    <div class="hdr-right"><span class="hdr-greet">Ho≈ü geldin, PASOVART üëã</span><div class="hdr-avatar">F</div></div>
  </header>
  <div class="content">
    <div class="pg on" id="pg-dashboard"></div>
    <div class="pg" id="pg-sessions"></div>
    <div class="pg" id="pg-clients"></div>
    <div class="pg" id="pg-client-auth"></div>
    <div class="pg" id="pg-panel-mgmt"></div>
    <div class="pg" id="pg-tasks"></div>
    <div class="pg" id="pg-contracts"></div>
    <div class="pg" id="pg-finance"></div>
    <div class="pg" id="pg-store-corlu"></div>
    <div class="pg" id="pg-store-ergene"></div>
  </div>
</div>
</div>

<div class="mo" id="mo" onclick="if(event.target===this)closeModal()">
  <div class="mo-box">
    <div class="mo-hd"><h3 id="moTitle">‚Äì</h3><button class="mo-cls" onclick="closeModal()"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
    <div id="moBody"></div>
  </div>
</div>

<div id="printModal" class="print-modal">
    <div class="print-modal-content">
        <span class="close-print-btn" onclick="closePrintModal()">&times;</span>
        <div class="ct-print-area" id="adminPrintArea">
            </div>
        <button class="admin-print-btn" onclick="window.print()">üñ®Ô∏è Bu Sayfayƒ± Yazdƒ±r</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyC82ZVx7sf6evT4zs3b5qoQ6H7eXTrf4Ng",
  authDomain: "pasovartpanel.firebaseapp.com",
  projectId: "pasovartpanel",
  storageBucket: "pasovartpanel.firebasestorage.app",
  messagingSenderId: "1031606727169",
  appId: "1:1031606727169:web:bde71345525d0ec7c90600",
  measurementId: "G-GTR6KPH1CL"
};

// LOGIN
const USERS = { 'ferdi': { pass: '123456', name: 'Ferdi' }, 'eren': { pass: '123456', name: 'Eren' }, 'muharrem': { pass: '123456', name: 'Muharrem' } };
let currentUser = null;
window.doLogin = function() {
  const user = document.getElementById('loginUser').value.toLowerCase();
  const pass = document.getElementById('loginPass').value;
  if (USERS[user] && USERS[user].pass === pass) {
    currentUser = { username: user, name: USERS[user].name };
    localStorage.setItem('pf_currentUser', JSON.stringify(currentUser));
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainApp').style.display = 'flex';
  } else { document.getElementById('loginError').style.display = 'block'; document.getElementById('loginError').textContent = 'Hatalƒ± giri≈ü'; }
}
function checkLogin() {
  const saved = localStorage.getItem('pf_currentUser');
  if (saved) { currentUser = JSON.parse(saved); document.getElementById('loginScreen').style.display = 'none'; document.getElementById('mainApp').style.display = 'flex'; }
}

// FIREBASE
let db = null; let useFirebase = false; let _doc, _collection, _setDoc, _deleteDoc, _getDocs;
async function initFirebase() {
  try {
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js');
    const { getFirestore, doc, collection, setDoc, deleteDoc, getDocs } = await import('https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js');
    db = getFirestore(initializeApp(firebaseConfig));
    _doc=doc; _collection=collection; _setDoc=setDoc; _deleteDoc=deleteDoc; _getDocs=getDocs;
    useFirebase = true; setStatus('online', '√áevrimi√ßi'); await loadAllFromFirebase();
  } catch (e) { useFirebase = false; setStatus('offline', '√áevrimdƒ±≈üƒ± (Yerel)'); loadAllFromLocal(); }
  checkLogin(); render('dashboard');
}
function setStatus(state, txt) {
  document.getElementById('statusDot').className = 'status-dot'+(state==='online'?'':' offline');
  document.getElementById('statusTxt').textContent = txt;
}

// DATA
let clients=[], sessions=[], tasks=[], contracts=[], expenses=[], incomes=[];
async function loadAllFromFirebase() {
  clients = await fbGetAll('clients'); sessions = await fbGetAll('sessions');
  tasks = await fbGetAll('tasks'); contracts = await fbGetAll('contracts');
  expenses = await fbGetAll('expenses'); incomes = await fbGetAll('incomes');
}
async function fbGetAll(col) { try { const snap = await _getDocs(_collection(db, col)); return snap.docs.map(d=>({...d.data(),_fbId:d.id})); } catch{return[]} }
async function fbAdd(col, obj) {
  if(!useFirebase) return obj;
  try{ const id=(crypto&&crypto.randomUUID)?crypto.randomUUID():String(Date.now()); await _setDoc(_doc(db,col,id),{...obj}); obj._fbId=id; showToast('Kaydedildi ‚úì','success'); }catch(e){showToast('Hata','error')} return obj;
}
async function fbUpdate(col, obj) { if(useFirebase&&obj._fbId) await _setDoc(_doc(db,col,obj._fbId),{...obj}); showToast('G√ºncellendi ‚úì','success'); }
async function fbDelete(col, fbId) { if(useFirebase&&fbId) await _deleteDoc(_doc(db,col,fbId)); showToast('Silindi ‚úì','success'); }

// LOCAL STORAGE
const ld = (k, fb) => { try { return JSON.parse(localStorage.getItem('pf_'+k))||fb; } catch { return fb; } };
const sv = () => {
  if(useFirebase) return;
  localStorage.setItem('pf_clients',JSON.stringify(clients)); localStorage.setItem('pf_sessions',JSON.stringify(sessions));
  localStorage.setItem('pf_tasks',JSON.stringify(tasks)); localStorage.setItem('pf_contracts',JSON.stringify(contracts));
  localStorage.setItem('pf_expenses',JSON.stringify(expenses)); localStorage.setItem('pf_incomes',JSON.stringify(incomes));
  showToast('Kaydedildi ‚úì','success');
};
function loadAllFromLocal() {
  clients=ld('clients',[]); sessions=ld('sessions',[]); tasks=ld('tasks',[]); contracts=ld('contracts',[]); expenses=ld('expenses',[]); incomes=ld('incomes',[]);
}

// UTILS
const uid = () => Date.now() + (Math.random()*9999|0);
const cn = id => (clients.find(c=>c.id==id)||{}).name||'‚Äì';
const cp = id => (clients.find(c=>c.id==id)||{}).phone||'';
const fm = n => Number(n).toLocaleString('tr-TR');
const fmtDate = d => {
  if(!d) return '-';
  const dateObj = new Date(d);
  return dateObj.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
};
const I = {
  plus:`<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
  trash:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>`,
  edit:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
  key:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>`,
  set:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
  print:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>`,
  eye: `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>`
};

// HELPER: Stage Naming
function getStageLabel(stage, pkg) {
    const isWedding = (pkg || "").toLowerCase().includes('d√ºƒü√ºn');
    let labels = [];
    if(isWedding) labels = ["√áekim", "Yedekleme", "Montaj", "Teslimata Hazƒ±r", "Teslim Edildi"];
    else labels = ["√áekim", "Yedekleme", "D√ºzenleme", "Baskƒ±", "Teslimata Hazƒ±r", "Teslim Edildi"];
    return labels[stage - 1] || `${stage}. Adƒ±m`;
}

// NAV & MOBILE
window.toggleSub=function(e){ e.preventDefault(); e.currentTarget.classList.toggle('open'); }
window.toggleSidebar=function(){ document.getElementById('sidebar').classList.toggle('active'); document.getElementById('sidebarOverlay').classList.toggle('active'); }
let cur='dashboard';
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.nav-item').forEach(btn => {
    if (!btn.classList.contains('has-sub')) {
      btn.addEventListener('click', function() {
        if(window.innerWidth<=768) window.toggleSidebar();
        const tab = this.dataset.tab; if(tab) go(tab);
      });
    }
  });
});
function go(k) {
  cur=k; document.querySelectorAll('.nav-item').forEach(b=>{if(!b.classList.contains('has-sub'))b.classList.toggle('active',b.dataset.tab===k)});
  document.querySelectorAll('.pg').forEach(p=>p.classList.remove('on'));
  if(document.getElementById('pg-'+k)) { document.getElementById('pg-'+k).classList.add('on'); render(k); }
}

// RENDERERS
function render(k) {
  const pages = {
    dashboard: rDash, sessions: rSess, clients: rCli, 'client-auth': rCliAuth,
    'panel-mgmt': rPanelMgmt,
    tasks: rTask, contracts: rCont, finance: rFin,
    'store-corlu': ()=>rStore('corlu'), 'store-ergene': ()=>rStore('ergene')
  };
  if(pages[k]) document.getElementById('pg-'+k).innerHTML = pages[k]();
}

function rDash() {
  const inc=incomes.reduce((a,i)=>a+i.amt,0), exp=expenses.reduce((a,e)=>a+e.amt,0);
  const receivables = clients.reduce((acc, c) => acc + (c.total - c.paid), 0);
  const up=sessions.filter(s=>s.status==='upcoming').sort((a,b)=>new Date(a.date)-new Date(b.date));
   
  return `<div class="stat-grid">
    <div class="card stat"><div class="stat-ico" style="background:#ecfdf5"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div><div class="stat-lbl">Toplam Gelir (Kasa)</div><div class="stat-val" style="color:#10b981">‚Ç∫${fm(inc)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#fef2f2"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg></div><div><div class="stat-lbl">Toplam Gider</div><div class="stat-val" style="color:#ef4444">‚Ç∫${fm(exp)}</div></div></div>
    <div class="card stat clickable" onclick="openReceivablesList()" style="cursor:pointer"><div class="stat-ico" style="background:#eff6ff"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><path d="M12 2v20M2 12h20" stroke-opacity="0"/><path d="M17 9V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M9 9h.01"/><path d="M12 15v3m0 0l-3-3m3 3l3-3"/><path d="M22 17v2a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg></div><div><div class="stat-lbl">Alƒ±nacak √ñdemeler</div><div class="stat-val" style="color:#3b82f6">‚Ç∫${fm(receivables)}</div></div></div>
  </div>
  <div class="card card-p"><div class="ph" style="margin-bottom:14px"><h3 style="font-size:16px;font-weight:700">üì∏ Yakla≈üan √áekimler</h3></div>
  ${up.slice(0,5).map(s=>{
    const dObj = new Date(s.date);
    const day = dObj.getDate();
    const fullDate = fmtDate(s.date);
    const clientName = cn(s.cid);
    const clientPhone = cp(s.cid);
    
    return `<div class="click-row" onclick="openSessionDetail(${s.id})" style="display:flex;align-items:center;gap:13px;padding:11px 10px;border-bottom:1px solid #f1f5f9;border-radius:8px;">
      <div style="width:50px;height:50px;border-radius:11px;background:linear-gradient(135deg,#dbeafe,#bfdbfe);display:flex;flex-direction:column;align-items:center;justify-content:center;color:#1e40af;font-weight:800;line-height:1;flex-shrink:0;">
        <span style="font-size:18px">${day}</span>
      </div>
      <div style="flex:1">
        <div style="font-weight:700;font-size:15px;color:var(--txt)">${clientName}</div>
        <div style="font-size:12px;color:var(--txt3);display:flex;align-items:center;gap:6px;">
          <span>üìû ${clientPhone}</span> ‚Ä¢ <span>${s.pkg}</span>
        </div>
        <div style="font-size:12px;color:var(--acc);font-weight:500;margin-top:2px;">${fullDate}</div>
      </div>
      <div style="font-weight:700;color:#1e40af;font-size:15px">‚Ç∫${fm(s.total)}</div>
    </div>`
  }).join('')}</div>`;
}

function rPanelMgmt() {
  return `
  <div class="ph"><h2>‚öôÔ∏è M√º≈üteri Paneli Y√∂netimi</h2></div>
  <div class="card card-p">
    <div class="tbl-wrap"><table>
      <thead><tr><th>M√º≈üteri</th><th>A≈üama</th><th>Bor√ß Durumu</th><th>ƒ∞≈ülem</th></tr></thead>
      <tbody>
        ${clients.map(c => {
          const debt = (c.total || 0) - (c.paid || 0);
          const pkg = (c.session && c.session.pkg) ? c.session.pkg : "";
          const stageLbl = getStageLabel(c.stage || 1, pkg);

          return `<tr>
            <td style="font-weight:600">${c.name}</td>
            <td><span class="badge b-active">${stageLbl}</span></td>
            <td>${debt > 0 ? `<span style="color:var(--red)">‚Ç∫${fm(debt)} Bor√ß</span>` : '<span style="color:var(--grn)">√ñdendi</span>'}</td>
            <td>
              <button class="btn btn-e btn-sm" onclick="openMo('panelMgmt', ${c.id})">${I.set} Y√∂net</button>
              <button class="btn btn-d btn-sm" onclick="del('client', '${c.id}')" style="margin-left:5px">${I.trash}</button>
            </td>
          </tr>`
        }).join('')}
      </tbody>
    </table></div>
  </div>`;
}

function rCliAuth() {
  return `<div class="ph"><h2>üîê M√º≈üteri Giri≈ü Y√∂netimi</h2></div><div class="card card-p"><div class="tbl-wrap"><table><thead><tr><th>M√º≈üteri</th><th>Kullanƒ±cƒ± Adƒ±</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead><tbody>${clients.map(c=>`<tr><td style="font-weight:600">${c.name}</td><td>${c.username||'<em style="color:#94a3b8">Yok</em>'}</td><td>${c.username?'<span class="badge b-active">Aktif</span>':'<span class="badge b-pending">Pasif</span>'}</td><td><button class="btn btn-e btn-sm" onclick="openMo('auth',${c.id})">${I.key} D√ºzenle</button><button class="btn btn-d btn-sm" onclick="del('client', '${c.id}')" style="margin-left:5px">${I.trash}</button></td></tr>`).join('')}</tbody></table></div></div>`;
}

function rStore(code) {
  const name=code==='corlu'?'√áorlu':'Ergene';
  const sInc=incomes.filter(i=>i.store===code), sExp=expenses.filter(e=>e.store===code);
  const totInc=sInc.reduce((a,b)=>a+b.amt,0), totExp=sExp.reduce((a,b)=>a+b.amt,0);
  const items=[...sInc.map(i=>({...i,t:'inc'})),...sExp.map(e=>({...e,t:'exp'}))].sort((a,b)=>new Date(b.date)-new Date(a.date));
  return `<div class="ph"><h2>üè™ ${name} ≈ûubesi</h2></div><div class="stat-grid"><div class="card stat"><div class="stat-ico" style="background:#ecfdf5"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div><div class="stat-lbl">Gelir</div><div class="stat-val" style="color:#10b981">‚Ç∫${fm(totInc)}</div></div></div><div class="card stat"><div class="stat-ico" style="background:#fef2f2"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg></div><div><div class="stat-lbl">Gider</div><div class="stat-val" style="color:#ef4444">‚Ç∫${fm(totExp)}</div></div></div></div><div class="card card-p"><h3 style="font-size:16px;font-weight:700;margin-bottom:15px">Hareketler</h3><div class="tbl-wrap"><table><thead><tr><th>Tarih</th><th>A√ßƒ±klama</th><th>T√ºr√º</th><th>Tutar</th></tr></thead><tbody>${items.length?items.map(x=>`<tr><td>${fmtDate(x.date)}</td><td style="font-weight:600">${x.desc}</td><td>${x.t==='inc'?'<span style="color:var(--grn)">Gelir</span>':'<span style="color:var(--red)">Gider</span>'}</td><td style="font-weight:700">${x.t==='inc'?'+':'-'}‚Ç∫${fm(x.amt)}</td></tr>`).join(''):'<tr><td colspan="4" style="text-align:center;color:var(--txt3)">Kayƒ±t yok.</td></tr>'}</tbody></table></div></div>`;
}

function rTask() {
  const cols = [{k:'todo',l:'Yapƒ±lacak',c:'#7c3aed'},{k:'inprogress',l:'S√ºr√ºyor',c:'#d97706'},{k:'done',l:'Bitti',c:'#16a34a'}];
  return `<div class="ph"><h2>üìå G√∂revler</h2><button class="btn btn-p" onclick="openMo('task')">${I.plus} Yeni</button></div><div class="kanban">${cols.map(col => { const its=tasks.filter(t=>t.status===col.k); return `<div class="kb-col"><div class="kb-head"><strong style="color:${col.c}">${col.l}</strong><span style="font-size:11px;padding:2px 8px;border-radius:10px;background:${col.c}1a;color:${col.c}">${its.length}</span></div><div class="kb-cards">${its.map(t=>`<div class="kb-card"><div style="display:flex;justify-content:space-between;font-weight:600;font-size:13px">${t.title}</div>${t.desc?`<div style="font-size:11px;color:var(--txt2);margin-top:4px;line-height:1.4">${t.desc}</div>`:''}<div style="font-size:10px;color:var(--txt3);margin-top:6px;font-weight:700">${fmtDate(t.due)}</div><div style="margin-top:8px;display:flex;gap:5px"><button class="btn btn-e btn-sm" onclick="openMo('task',${t.id})">${I.edit}</button><button class="btn btn-d btn-sm" onclick="del('task',${t.id})">${I.trash}</button></div></div>`).join('')}</div></div>`; }).join('')}</div>`;
}

// ‚îÄ‚îÄ‚îÄ G√úNCELLENEN S√ñZLE≈ûMELER B√ñL√úM√ú ‚îÄ‚îÄ‚îÄ
function rCont() {
  return `<div class="ph"><h2>üìÑ S√∂zle≈ümeler</h2></div><div class="tbl-wrap"><table><thead><tr><th>M√º≈üteri (Detay)</th><th>Olu≈üturma</th><th>Bakiye</th><th>ƒ∞≈ülem</th></tr></thead><tbody>${contracts.map(c=>{
    const sess = sessions.find(s => s.cid === c.cid && s.date === c.date) || {};
    const detailAction = sess.id ? `onclick="openSessionDetail(${sess.id})"` : '';
    // YAZDIR BUTONU G√úNCELLENDƒ∞ -> viewContractForPrint
    return `<tr><td style="font-weight:600; cursor:pointer; color:var(--acc);" ${detailAction}>${cn(c.cid)} ${I.eye}</td><td>${fmtDate(c.date)}</td><td>${(c.total-c.paid)>0 ? '<span style="color:var(--red)">Bor√ßlu</span>' : '<span style="color:var(--grn)">√ñdendi</span>'}</td><td style="display:flex;gap:5px"><button class="btn btn-e btn-sm" onclick="viewContractForPrint(${c.id})">${I.print} Yazdƒ±r</button><button class="btn btn-d btn-sm" onclick="del('contract',${c.id})">${I.trash}</button></td></tr>`;
  }).join('')}</tbody></table></div>`;
}

function rSess() { return `<div class="ph"><h2>üì∑ √áekimler</h2><button class="btn btn-p" onclick="openMo('session')">${I.plus} Yeni</button></div><div class="tbl-wrap"><table><thead><tr><th>M√º≈üteri</th><th>Tarih</th><th>Paket</th><th>Tutar</th><th>ƒ∞≈ülem</th></tr></thead><tbody>${sessions.map(s=>`<tr><td style="font-weight:600">${cn(s.cid)}</td><td>${fmtDate(s.date)}</td><td>${s.pkg}</td><td>‚Ç∫${fm(s.total)}</td><td style="display:flex;gap:5px"><button class="btn btn-e btn-sm" onclick="openSessionDetail(${s.id})">${I.eye}</button><button class="btn btn-e btn-sm" onclick="openMo('session',${s.id})">${I.edit}</button><button class="btn btn-d btn-sm" onclick="del('session',${s.id})">${I.trash}</button></td></tr>`).join('')}</tbody></table></div>`; }
function rCli() { return `<div class="ph"><h2>üë§ M√º≈üteriler</h2><button class="btn btn-p" onclick="openMo('client')">${I.plus} Yeni</button></div><div class="cl-grid">${clients.map(c=>`<div class="card cl-card"><div class="cl-head"><div class="cl-ava">${I.edit}</div><div><div style="font-weight:700">${c.name}</div><div style="font-size:12px">${c.phone}</div></div><button class="btn btn-d btn-sm" onclick="del('client',${c.id})">${I.trash}</button></div></div>`).join('')}</div>`; }
function rFin() { return `<div class="ph"><h2>üí∞ Gelir / Gider</h2><div style="display:flex;gap:8px"><button class="btn btn-p" onclick="openMo('income')">${I.plus} Gelir</button><button class="btn btn-p" style="background:linear-gradient(135deg,#dc2626,#ef4444);box-shadow:0 2px 8px rgba(239,68,68,.3)" onclick="openMo('expense')">${I.plus} Gider</button></div></div><div class="card card-p"><div class="tbl-wrap"><table><thead><tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>ƒ∞≈ülem</th></tr></thead><tbody>${[...incomes.map(i=>({...i,t:'inc'})),...expenses.map(e=>({...e,t:'exp'}))].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,10).map(x=>`<tr><td>${fmtDate(x.date)}</td><td>${x.desc}</td><td style="font-weight:700;color:${x.t==='inc'?'var(--grn)':'var(--red)'}">${x.t==='inc'?'+':'-'}‚Ç∫${fm(x.amt)}</td><td><button class="btn btn-d btn-sm" onclick="del('${x.t==='inc'?'income':'expense'}',${x.id})">${I.trash}</button></td></tr>`).join('')}</tbody></table></div></div>`; }

// ACTIONS
window.del = async function(type, id) {
  const map={session:'sessions',client:'clients',task:'tasks',contract:'contracts',expense:'expenses',income:'incomes'};
  const col=map[type], item=eval(col).find(x=>x.id===id);
  if(useFirebase && item && item._fbId) await fbDelete(col,item._fbId);
  eval(`${col}=${col}.filter(x=>x.id!==${id})`); if(!useFirebase) sv(); render(cur);
}

// MODALS
const moTitles={session:'√áekim Ekle',client:'M√º≈üteri Ekle',task:'G√∂rev Ekle',contract:'S√∂zle≈üme Ekle',expense:'Gider Ekle',income:'Gelir Ekle',auth:'Giri≈ü Bilgileri', panelMgmt:'Panel Y√∂netimi', detail: '√áekim Detaylarƒ±', receivables: 'Alacak Listesi'};
let _moType='', _moId=null;
window.openMo=function(type,editId){
  _moType=type; _moId=editId||null;
  document.getElementById('moTitle').textContent=editId&&type!=='auth'&&type!=='panelMgmt'?'D√ºzenle':moTitles[type];
  document.getElementById('moBody').innerHTML=moForms[type](editId);
  document.getElementById('mo').classList.add('on');
}
window.closeModal=function(){document.getElementById('mo').classList.remove('on')}
const v=id=>(document.getElementById(id)||{}).value||'';

window.openReceivablesList = function() {
  const indebtedClients = clients.filter(c => (c.total - c.paid) > 0);
  if(indebtedClients.length === 0) { showToast('T√ºm √∂demeler alƒ±nmƒ±≈ü.', 'success'); return; }
  let html = `<div class="tbl-wrap"><table><thead><tr><th>M√º≈üteri</th><th>Telefon</th><th>Hizmet/Etkinlik</th><th>Kalan Tutar</th></tr></thead><tbody>`;
  indebtedClients.forEach(c => {
    let pkgInfo = '-';
    if(c.session && c.session.pkg) pkgInfo = c.session.pkg; 
    else { const s = sessions.find(sess => sess.cid === c.id); if(s) pkgInfo = s.pkg; }
    const remaining = c.total - c.paid;
    html += `<tr><td style="font-weight:600">${c.name}</td><td>${c.phone}</td><td style="font-size:12px; color:var(--txt2)">${pkgInfo}</td><td style="font-weight:700; color:var(--red)">‚Ç∫${fm(remaining)}</td></tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('moTitle').textContent = 'Alacak Listesi';
  document.getElementById('moBody').innerHTML = html;
  document.getElementById('mo').classList.add('on');
}

window.openSessionDetail = function(id) {
  const s = sessions.find(x => x.id === id);
  if(!s) return;
  const c = clients.find(x => x.id === s.cid) || {};
  const content = `
    <div style="padding-bottom:10px; border-bottom:1px solid #e2e8f0; margin-bottom:15px; text-align:center;">
       <div style="font-size:18px; font-weight:800; color:var(--txt)">${c.name}</div>
       <div style="font-size:14px; color:var(--acc); font-weight:600; margin-top:4px;">${s.pkg}</div>
    </div>
    <div class="det-row"><div class="det-lbl">Telefon</div><div class="det-val">${c.phone || '-'}</div></div>
    <div class="det-row"><div class="det-lbl">Tarih</div><div class="det-val">${fmtDate(s.date)}</div></div>
    <div class="det-row"><div class="det-lbl">Saat</div><div class="det-val">${s.time || '-'}</div></div>
    <div class="det-row"><div class="det-lbl">Mekan/Konum</div><div class="det-val">${s.loc || '-'}</div></div>
    <div style="background:#f8fafc; padding:12px; border-radius:8px; margin:15px 0;">
      <div class="det-row" style="margin-bottom:6px; border:none;"><div class="det-lbl">Toplam Tutar</div><div class="det-val">‚Ç∫${fm(s.total)}</div></div>
      <div class="det-row" style="margin-bottom:6px; border:none;"><div class="det-lbl">√ñdenen</div><div class="det-val" style="color:var(--grn)">‚Ç∫${fm(s.paid)}</div></div>
      <div class="det-row" style="margin-bottom:0; border:none;"><div class="det-lbl">Kalan</div><div class="det-val" style="color:var(--red)">‚Ç∫${fm(s.total - s.paid)}</div></div>
    </div>
    <div style="font-size:12px; font-weight:700; color:var(--txt3); margin-bottom:5px; text-transform:uppercase;">Notlar / A√ßƒ±klama</div>
    <div style="font-size:14px; color:var(--txt2); line-height:1.5; background:#fff; border:1px solid #e2e8f0; padding:10px; border-radius:8px;">${s.desc || 'Not girilmemi≈ü.'}</div>
  `;
  document.getElementById('moTitle').textContent = '√áekim Detaylarƒ±';
  document.getElementById('moBody').innerHTML = content;
  document.getElementById('mo').classList.add('on');
}

const moForms={
  auth:(id)=>{
    const c=clients.find(x=>x.id===id);
    return `<div class="fg"><label>M√º≈üteri</label><input type="text" value="${c.name}" disabled style="background:#e2e8f0"/></div><div class="fg"><label>Kullanƒ±cƒ± Adƒ±</label><input type="text" id="f_user" value="${c.username||''}"/></div><div class="fg"><label>≈ûifre</label><input type="text" id="f_pass" value="${c.password||''}"/></div><button class="btn btn-p f-sub" onclick="subAuth(${id})">Kaydet</button>`;
  },
  panelMgmt:(id)=>{
    const c = clients.find(x=>x.id===id);
    const s = c.session || {}; 
    const pkgName = (s.pkg || "").toLowerCase();
    const isWedding = pkgName.includes("d√ºƒü√ºn");
    let stageOptions = "";
    if(isWedding) {
        const steps = ["√áekim", "Yedekleme", "Montaj", "Teslimata Hazƒ±r", "Teslim Edildi"];
        stageOptions = steps.map((label, i) => {
            const val = i + 1;
            const sel = c.stage == val ? 'selected' : '';
            return `<option value="${val}" ${sel}>${val}. ${label}</option>`;
        }).join('');
    } else {
        const steps = ["√áekim", "Yedekleme", "D√ºzenleme", "Baskƒ±", "Teslimata Hazƒ±r", "Teslim Edildi"];
        stageOptions = steps.map((label, i) => {
            const val = i + 1;
            const sel = c.stage == val ? 'selected' : '';
            return `<option value="${val}" ${sel}>${val}. ${label}</option>`;
        }).join('');
    }
    return `
      <div class="fg"><label>M√º≈üteri</label><input type="text" value="${c.name}" disabled style="background:#e2e8f0; font-weight:bold"/></div>
      <div class="section-title">Finansal Durum</div>
      <div class="fr"><div class="fg"><label>Anla≈üma Tutarƒ± (‚Ç∫)</label><input type="number" id="pm_total" value="${c.total||0}"/></div><div class="fg"><label>√ñdenen Tutar (‚Ç∫)</label><input type="number" id="pm_paid" value="${c.paid||0}"/></div></div>
      <div class="section-title">ƒ∞≈ü Akƒ±≈üƒ± (Durum G√ºncelle)</div>
      <div class="fg"><label>Mevcut A≈üama (${isWedding ? 'D√ºƒü√ºn Paketi' : 'Standart Paket'})</label><select id="pm_stage">${stageOptions}</select></div>
      <div class="section-title">√áekim Detaylarƒ± (M√º≈üteri G√∂r√ºn√ºm√º)</div>
      <div class="fr"><div class="fg"><label>Tarih</label><input type="date" id="pm_date" value="${s.date||''}"/></div><div class="fg"><label>Saat</label><input type="time" id="pm_time" value="${s.time||''}"/></div></div>
      <div class="fg"><label>Paket Adƒ±</label><input type="text" id="pm_pkg" value="${s.pkg||''}"/></div>
      <div class="fg"><label>Konum</label><input type="text" id="pm_loc" value="${s.loc||''}"/></div>
      <div class="fg"><label>Durum Yazƒ±sƒ± (√ñrn: Planlanƒ±yor)</label><input type="text" id="pm_status" value="${s.status||'Planlanƒ±yor'}"/></div>
      <button class="btn btn-p f-sub" onclick="subPanelMgmt(${id})">Bilgileri G√ºncelle</button>
    `;
  },
  session:(id)=>{
    const o=id?sessions.find(s=>s.id===id):{};
    const cName = o.cid ? cn(o.cid) : '';
    return `
      <div class="fg">
        <label>M√º≈üteri (Se√ß veya Yeni Yaz)</label>
        <input type="text" id="f_cname" list="dl_clients" placeholder="M√º≈üteri adƒ±..." value="${cName}" autocomplete="off"/>
        <datalist id="dl_clients">${clients.map(c=>`<option value="${c.name}">`).join('')}</datalist>
      </div>
      <div class="fr"><div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date||''}"/></div><div class="fg"><label>Saat</label><input type="time" id="f_time" value="${o.time||''}"/></div></div>
      <div class="fg"><label>Telefon (Yeni M√º≈üteri ƒ∞√ßin)</label><input type="text" id="f_cphone" placeholder="05xx..."/></div>
      <div class="fr"><div class="fg"><label>Toplam Tutar (‚Ç∫)</label><input type="number" id="f_total" value="${o.total||''}"/></div><div class="fg"><label>${id?'√ñdenen Tutar':'√ñn √ñdeme (Kapora)'} (‚Ç∫)</label><input type="number" id="f_paid" value="${o.paid||''}"/></div></div>
      <div class="fg"><label>Paket</label><input type="text" id="f_pkg" value="${o.pkg||''}"/></div>
      <div class="fg"><label>Konum</label><input type="text" id="f_loc" value="${o.loc||''}"/></div>
      <div class="fg"><label>A√ßƒ±klama</label><textarea id="f_desc" placeholder="Detaylar...">${o.desc||''}</textarea></div>
      <button class="btn btn-p f-sub" onclick="subSession(${id||0})">Kaydet</button>
    `;
  },
  client:(id)=>{ const o=id?clients.find(c=>c.id===id):{}; return `<div class="fg"><label>Ad</label><input type="text" id="f_name" value="${o.name||''}"/></div><div class="fg"><label>Tel</label><input type="text" id="f_phone" value="${o.phone||''}"/></div><button class="btn btn-p f-sub" onclick="subClient(${id||0})">Kaydet</button>`; },
  task:(id)=>{ const o=id?tasks.find(t=>t.id===id):{}; return `<div class="fg"><label>Ba≈ülƒ±k</label><input type="text" id="f_title" value="${o.title||''}"/></div><div class="fg"><label>A√ßƒ±klama</label><textarea id="f_desc">${o.desc||''}</textarea></div><div class="fg"><label>Son Tarih</label><input type="date" id="f_due" value="${o.due||''}"/></div>${id?`<div class="fg"><label>Durum</label><select id="f_stat"><option value="todo" ${o.status=='todo'?'selected':''}>Yapƒ±lacak</option><option value="inprogress" ${o.status=='inprogress'?'selected':''}>S√ºr√ºyor</option><option value="done" ${o.status=='done'?'selected':''}>Bitti</option></select></div>`:''}<button class="btn btn-p f-sub" onclick="subTask(${id||0})">Kaydet</button>`; },
  contract:()=>{ return ``; }, 
  expense:(id)=>{ const o=id?expenses.find(x=>x.id===id):{}; return `<div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date||''}"/></div><div class="fg"><label>A√ßƒ±klama</label><input type="text" id="f_desc" value="${o.desc||''}"/></div><div class="fr"><div class="fg"><label>Tutar</label><input type="number" id="f_amt" value="${o.amt||''}"/></div><div class="fg"><label>≈ûube</label><select id="f_store"><option value="">Genel</option><option value="corlu" ${o.store=='corlu'?'selected':''}>√áorlu</option><option value="ergene" ${o.store=='ergene'?'selected':''}>Ergene</option></select></div></div><button class="btn btn-p f-sub" onclick="subExpInc('expenses',${id||0})">Kaydet</button>`; },
  
  income:(id)=>{ 
    const o=id?incomes.find(x=>x.id===id):{}; 
    return `
      <div class="fg">
        <label>1. M√º≈üteri Se√ß (Bor√ßtan D√º≈ümesi ƒ∞√ßin)</label>
        <input type="text" id="f_inc_client" list="dl_inc_clients" placeholder="M√º≈üteri Ara..." onchange="onClientChange(this)" autocomplete="off"/>
        <datalist id="dl_inc_clients">${clients.map(c=>`<option value="${c.name}">`).join('')}</datalist>
      </div>
      <div class="fg" id="div_inc_job" style="display:none">
        <label>2. Hangi ƒ∞≈ü ƒ∞√ßin √ñdeme Alƒ±nƒ±yor?</label>
        <select id="f_inc_job" onchange="autoFillJobDesc()"></select>
      </div>
      <div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date||''}"/></div>
      <div class="fg"><label>A√ßƒ±klama (Otomatik Olu≈üur)</label><input type="text" id="f_desc" value="${o.desc||''}"/></div>
      <div class="fr">
        <div class="fg"><label>Tutar (‚Ç∫)</label><input type="number" id="f_amt" value="${o.amt||''}"/></div>
        <div class="fg"><label>≈ûube</label><select id="f_store"><option value="">Genel</option><option value="corlu" ${o.store=='corlu'?'selected':''}>√áorlu</option><option value="ergene" ${o.store=='ergene'?'selected':''}>Ergene</option></select></div>
      </div>
      <button class="btn btn-p f-sub" onclick="subExpInc('incomes',${id||0})">Kaydet ve Bakiyeden D√º≈ü</button>
    `; 
  }
};

window.onClientChange = function(el) {
    const val = el.value;
    const client = clients.find(c => c.name === val);
    const jobSelect = document.getElementById('f_inc_job');
    const jobDiv = document.getElementById('div_inc_job');
    
    if(client) {
        const clientSessions = sessions.filter(s => s.cid === client.id);
        if(clientSessions.length > 0) {
            jobDiv.style.display = 'block';
            let opts = `<option value="">Se√ßiniz...</option>`;
            clientSessions.forEach(s => {
                const debt = s.total - s.paid;
                opts += `<option value="${s.id}" data-pkg="${s.pkg}" data-debt="${debt}">${fmtDate(s.date)} - ${s.pkg} (Kalan: ‚Ç∫${fm(debt)})</option>`;
            });
            jobSelect.innerHTML = opts;
        } else {
             jobDiv.style.display = 'none';
             document.getElementById('f_desc').value = `${client.name} - √ñdeme (Tel: ${client.phone})`;
        }
    } else {
        jobDiv.style.display = 'none';
    }
}

window.autoFillJobDesc = function() {
    const clientName = document.getElementById('f_inc_client').value;
    const client = clients.find(c => c.name === clientName);
    const jobSelect = document.getElementById('f_inc_job');
    const selectedOpt = jobSelect.options[jobSelect.selectedIndex];
    
    if(selectedOpt && selectedOpt.value) {
        const pkg = selectedOpt.getAttribute('data-pkg');
        document.getElementById('f_desc').value = `${clientName} - ${pkg} √ñdemesi (Tel: ${client.phone})`;
    } else if (client) {
        document.getElementById('f_desc').value = `${clientName} - Genel √ñdeme (Tel: ${client.phone})`;
    }
}

window.subAuth = async function(id) {
  const c=clients.find(x=>x.id===id); c.username=v('f_user'); c.password=v('f_pass');
  await persistOne('clients',c); closeModal(); render('client-auth');
}
window.subPanelMgmt = async function(id) {
  const c = clients.find(x=>x.id===id);
  c.total = Number(v('pm_total')); 
  c.paid = Number(v('pm_paid')); 
  c.stage = Number(v('pm_stage')); 
  c.session = {
    date: v('pm_date'),
    time: v('pm_time'),
    pkg: v('pm_pkg'),
    loc: v('pm_loc'),
    status: v('pm_status') || 'Planlanƒ±yor'
  };
  await persistOne('clients', c); closeModal(); render('panel-mgmt');
}

window.subSession = async function(id) {
  const cName = v('f_cname');
  if(!cName) { showToast('M√º≈üteri adƒ± gerekli!','error'); return; }
  let cid;
  const existingClient = clients.find(c => c.name.toLowerCase() === cName.toLowerCase());
  
  const total = Number(v('f_total'));
  const paid = Number(v('f_paid'));

  const date = v('f_date');
  const time = v('f_time');
  const pkg = v('f_pkg');
  const loc = v('f_loc');
  const desc = v('f_desc');

  const sessionSummary = {
    date: date, time: time, pkg: pkg, loc: loc, status: 'Planlanƒ±yor'
  };
  
  if (existingClient) { 
    cid = existingClient.id;
    existingClient.total = (existingClient.total || 0) + total;
    existingClient.paid = (existingClient.paid || 0) + paid;
    existingClient.session = sessionSummary;
    await persistOne('clients', existingClient);
  } else {
    cid = uid();
    const newClient = { id: cid, name: cName, phone: v('f_cphone'), type: 'Genel', total: total, paid: paid, session: sessionSummary };
    await persistOne('clients', newClient, true);
    clients.push(newClient);
  }
  
  const obj = { id: id||uid(), cid: cid, date: date, time: time, total: total, paid: paid, pkg: pkg, loc: loc, desc: desc, status: 'upcoming' };
  
  if(id){ const i=sessions.findIndex(x=>x.id===id); sessions[i]={...sessions[i],...obj}; await persistOne('sessions',sessions[i]); }
  else { 
    sessions.push(obj); await persistOne('sessions',obj,true); 
    if(paid > 0) {
      const inc = { id: uid(), date: date, desc: `${cName} - ${pkg} Kapora (Tel: ${existingClient ? existingClient.phone : v('f_cphone')})`, amt: paid, store: 'corlu' };
      incomes.push(inc); await persistOne('incomes', inc, true);
    }
    const cont = { id: uid(), cid: cid, date: date, total: total, paid: paid, status: 'pending', terms: `Hizmet: ${pkg} \nLokasyon: ${loc} \nNotlar: ${desc}` };
    contracts.push(cont); await persistOne('contracts', cont, true);
  }
  closeModal(); render('sessions');
}

window.subClient = async function(id) {
  const obj={id:id||uid(),name:v('f_name'),phone:v('f_phone')};
  if(id){const i=clients.findIndex(x=>x.id===id);clients[i]={...clients[i],...obj};await persistOne('clients',clients[i]);}
  else{clients.push(obj);await persistOne('clients',obj,true);} closeModal(); render('clients');
}
window.subTask = async function(id) {
  const obj={id:id||uid(),title:v('f_title'),desc:v('f_desc'),due:v('f_due'),status:v('f_stat')||'todo'};
  if(id){const i=tasks.findIndex(x=>x.id===id);tasks[i]={...tasks[i],...obj};await persistOne('tasks',tasks[i]);}
  else{tasks.push(obj);await persistOne('tasks',obj,true);} closeModal(); render('tasks');
}

window.subExpInc = async function(type, id) {
  const arr = type==='expenses' ? expenses : incomes;
  const clientName = (type==='incomes') ? document.getElementById('f_inc_client').value : '';
  const jobId = (type==='incomes') ? document.getElementById('f_inc_job').value : ''; 
  const amt = Number(v('f_amt'));
  
  const obj = { id: id || uid(), date: v('f_date'), desc: v('f_desc'), amt: amt, store: v('f_store') };

  if(type === 'incomes' && clientName && !id) { 
      const client = clients.find(c => c.name === clientName);
      if(jobId) {
          const session = sessions.find(s => s.id == jobId);
          if(session) {
              session.paid = (session.paid || 0) + amt;
              await persistOne('sessions', session); 
          }
      }
      if(client) {
          client.paid = (client.paid || 0) + amt;
          await persistOne('clients', client);
          showToast(`${client.name} bakiyesi g√ºncellendi.`, 'success');
      }
  }

  if(id){ const i=arr.findIndex(x=>x.id===id); arr[i]={...arr[i],...obj}; await persistOne(type,arr[i]); }
  else{ arr.push(obj); await persistOne(type,obj,true); } 
  closeModal(); render(cur);
}

// ‚îÄ‚îÄ‚îÄ YENƒ∞ S√ñZLE≈ûME YAZDIRMA (MODAL) FONKSƒ∞YONU ‚îÄ‚îÄ‚îÄ
window.viewContractForPrint = function(id) {
  const c = contracts.find(x => x.id === id);
  if(!c) return;

  const client = clients.find(x => x.id === c.cid) || {};
  const remaining = c.total - c.paid;
  const dateStr = new Date(c.date).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });

  const htmlContent = `
    <div class="ct-header">
        <div class="ct-logo">PASOVART<span>-photography-medya-film</span></div>
        <div style="font-size:12px; color:#555">${dateStr}</div>
    </div>

    <div class="ct-row"><span class="ct-lbl">M√º≈üteri Adƒ±:</span><span class="ct-val">${client.name}</span></div>
    <div class="ct-row"><span class="ct-lbl">Telefon:</span><span class="ct-val">${client.phone || '-'}</span></div>

    <div class="ct-box">
        <div class="ct-title">Hizmet Detaylarƒ±</div>
        <div class="ct-text">${(c.terms || '').replace(/\n/g, '<br>')}</div>
    </div>

    <div class="ct-box">
        <div class="ct-title">√ñdeme Tablosu</div>
        <div class="ct-row"><span class="ct-lbl">Toplam Tutar:</span><span class="ct-val">‚Ç∫${Number(c.total).toLocaleString('tr-TR')}</span></div>
        <div class="ct-row"><span class="ct-lbl">Alƒ±nan Kapora:</span><span class="ct-val">‚Ç∫${Number(c.paid).toLocaleString('tr-TR')}</span></div>
        <div class="ct-row"><span class="ct-lbl">Kalan Bakiye:</span><span class="ct-val" style="font-weight:800">‚Ç∫${Number(remaining).toLocaleString('tr-TR')}</span></div>
    </div>

    <div style="font-size:11px; color:#555; margin-top:20px; text-align:justify; line-height:1.4">
        ƒ∞≈übu s√∂zle≈üme taraflar arasƒ±nda yukarƒ±da belirtilen ≈üartlar dahilinde d√ºzenlenmi≈ütir.
        Hizmet alan ki≈üi, √ßekim tarihinden en ge√ß 3 g√ºn √∂ncesine kadar iptal hakkƒ±na sahiptir. 
        Kapora iadesi m√ºcbir sebepler dƒ±≈üƒ±nda yapƒ±lmamaktadƒ±r.
    </div>
  `;

  document.getElementById('adminPrintArea').innerHTML = htmlContent;
  document.getElementById('printModal').style.display = 'block';
}

window.closePrintModal = function() {
    document.getElementById('printModal').style.display = 'none';
}

// Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapatma
window.onclick = function(event) {
    const modal = document.getElementById('printModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
    // Diƒüer modal i√ßin de kontrol
    const mo = document.getElementById('mo');
    if (event.target == mo) {
        closeModal();
    }
}

async function persistOne(col, obj, isNew = false) {
  if(useFirebase) { if(isNew||!obj._fbId) await fbAdd(col,obj); else await fbUpdate(col,obj); } else { sv(); }
}
window.showToast = function(msg,type){const t=document.getElementById('toast');t.textContent=msg;t.className='toast on '+type;setTimeout(()=>t.classList.remove('on'),2400);}
initFirebase();
</script>
</body>
</html>
