<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PASOVART Paneli</title>

<!-- Firebase SDK yÃ¼kleme: modÃ¼ler (ESM) yÃ¶ntem â€” sandbox ortamlarda Ã§alÄ±ÅŸÄ±r -->

<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&display=swap');

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f0f4f8;--card:#fff;--sb:#1e293b;--sb2:#0f172a;
  --acc:#3b82f6;--acc2:#60a5fa;
  --txt:#1e293b;--txt2:#475569;--txt3:#94a3b8;
  --bdr:#f1f5f9;--bdr2:#e2e8f0;
  --grn:#10b981;--grn-bg:#ecfdf5;
  --red:#ef4444;--red-bg:#fef2f2;--red-l:#fee2e2;
  --amb:#f59e0b;--amb-bg:#fffbeb;
  --pur:#7c3aed;--pur-bg:#ede9fe;
  --blu:#0284c7;--blu-bg:#e0f2fe;
  --sh:0 2px 14px rgba(0,0,0,.07);
  --fn:'DM Sans',system-ui,sans-serif;
}
html,body{height:100%;overflow:hidden;font-family:var(--fn)}
body{background:var(--bg);color:var(--txt)}

/* â”€â”€â”€ APP SHELL â”€â”€â”€ */
.app{display:flex;height:100vh}

/* â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â• */
.sb{
  width:232px;flex-shrink:0;
  background:linear-gradient(180deg,var(--sb),var(--sb2));
  color:#fff;display:flex;flex-direction:column;
  box-shadow:2px 0 12px rgba(0,0,0,.12);
  position:relative;z-index:10;
}
.sb-logo{
  padding:24px 20px 20px;
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;gap:12px;
}
.sb-logo-icon{
  width:42px;height:42px;border-radius:12px;
  background:linear-gradient(135deg,#2563eb,#60a5fa);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 3px 10px rgba(37,99,235,.35);
}
.sb-logo-txt strong{font-size:18px;font-weight:800;letter-spacing:-.4px;display:block}
.sb-logo-txt em{font-size:10px;color:rgba(255,255,255,.4);font-style:normal;font-weight:500}

.sb-nav{flex:1;padding:14px 12px;overflow-y:auto}
.nav-item{
  width:100%;display:flex;align-items:center;gap:11px;
  padding:11px 14px;border-radius:10px;border:none;
  background:transparent;color:rgba(255,255,255,.52);
  font:500 14px/1 var(--fn);cursor:pointer;
  transition:all .18s;margin-bottom:3px;position:relative;
  text-align:left;
}
.nav-item:hover{background:rgba(255,255,255,.08);color:rgba(255,255,255,.88)}
.nav-item.active{background:rgba(59,130,246,.2);color:var(--acc2);font-weight:700}
.nav-item.active::after{
  content:'';position:absolute;right:14px;top:50%;transform:translateY(-50%);
  width:7px;height:7px;border-radius:50%;background:var(--acc2);
}
.nav-item svg{flex-shrink:0;width:19px;height:19px}

.sb-footer{
  padding:16px 20px;
  border-top:1px solid rgba(255,255,255,.07);
  font-size:11px;color:rgba(255,255,255,.25);
  display:flex;justify-content:space-between;align-items:center;
}
.sb-status{display:flex;align-items:center;gap:6px}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--grn)}
.status-dot.offline{background:#94a3b8}
.status-dot.connecting{background:var(--amb);animation:pulse 1.2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â• */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}

.hdr{
  background:var(--card);padding:12px 28px;
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid var(--bdr);flex-shrink:0;
  box-shadow:0 1px 4px rgba(0,0,0,.04);
}
.hdr-search{
  display:flex;align-items:center;gap:8px;
  background:#f8fafc;border-radius:10px;padding:9px 15px;
}
.hdr-search input{
  border:none;outline:none;background:transparent;
  font:400 14px var(--fn);color:var(--txt2);width:180px;
}
.hdr-right{display:flex;align-items:center;gap:14px}
.hdr-greet{font-size:13px;color:var(--txt3)}
.hdr-avatar{
  width:38px;height:38px;border-radius:10px;
  background:linear-gradient(135deg,#2563eb,#60a5fa);
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-weight:800;font-size:15px;
}

.content{flex:1;overflow-y:auto;padding:26px 28px}

/* â”€â”€â”€ PAGES â”€â”€â”€ */
.pg{display:none}.pg.on{display:block}

.ph{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.ph h2{font-size:21px;font-weight:800;color:var(--txt)}

/* â”€â”€â”€ BUTTONS â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  border:none;border-radius:10px;padding:9px 18px;
  font:600 14px var(--fn);cursor:pointer;
  transition:transform .12s,box-shadow .12s;
}
.btn:active{transform:scale(.96)}
.btn-p{background:linear-gradient(135deg,#1e40af,var(--acc));color:#fff;box-shadow:0 2px 8px rgba(59,130,246,.3)}
.btn-p:hover{box-shadow:0 3px 14px rgba(59,130,246,.4)}
.btn-g{background:#f1f5f9;color:var(--txt2)}.btn-g:hover{background:var(--bdr2)}
.btn-d{background:var(--red-l);color:var(--red)}.btn-d:hover{background:#fecaca}
.btn-e{background:#eef2ff;color:#4f46e5}.btn-e:hover{background:#e0e7ff}
.btn-sm{padding:5px 9px;font-size:12px;border-radius:8px}

/* â”€â”€â”€ CARDS â”€â”€â”€ */
.card{background:var(--card);border-radius:14px;box-shadow:var(--sh);border:1px solid var(--bdr)}
.card-p{padding:22px}

/* â”€â”€â”€ BADGES â”€â”€â”€ */
.badge{display:inline-block;padding:3px 11px;border-radius:20px;font-size:12px;font-weight:600;white-space:nowrap}
.b-upcoming{background:var(--blu-bg);color:var(--blu)}
.b-done,.b-completed,.b-signed{background:var(--grn-bg);color:var(--grn)}
.b-inprogress,.b-pending{background:var(--amb-bg);color:var(--amb)}
.b-todo{background:var(--pur-bg);color:var(--pur)}

/* â”€â”€â”€ STAT GRID â”€â”€â”€ */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px}
.stat{padding:18px 19px;display:flex;align-items:center;gap:15px}
.stat-ico{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.stat-lbl{font-size:11px;color:var(--txt3);font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.stat-val{font-size:21px;font-weight:800;margin-top:2px}

/* â”€â”€â”€ DASH ROWS â”€â”€â”€ */
.dash-2{display:grid;grid-template-columns:1.4fr 1fr;gap:18px}

.up-item{display:flex;align-items:center;gap:13px;padding:11px 0;border-bottom:1px solid var(--bdr)}
.up-item:last-child{border-bottom:none}
.daybox{
  width:46px;height:46px;border-radius:11px;flex-shrink:0;
  background:linear-gradient(135deg,#dbeafe,#bfdbfe);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;
}
.daybox .dn{font-size:16px;font-weight:800;color:#1e40af;line-height:1}
.daybox .dm{font-size:9px;font-weight:700;color:var(--acc);text-transform:uppercase}
.up-info{flex:1}.up-info .un{font:600 14px var(--fn);color:var(--txt)}
.up-info .us{font-size:12px;color:var(--txt3);margin-top:2px}
.up-price{text-align:right}
.up-price .upm{font:700 14px var(--fn);color:#1e40af}
.up-price .ups{font-size:11px;color:var(--txt3)}

.td-item{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--bdr)}
.td-item:last-child{border-bottom:none}
.pdot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.td-info{flex:1}.td-info .tn{font:600 13px var(--fn);color:var(--txt)}
.td-info .ts{font-size:11px;color:var(--txt3)}

/* â”€â”€â”€ TABLE â”€â”€â”€ */
.tbl-wrap{border-radius:14px;border:1px solid var(--bdr);box-shadow:var(--sh);overflow-x:auto}
table{width:100%;border-collapse:collapse;background:var(--card)}
thead tr{background:#f8fafc}
th{padding:11px 14px;text-align:left;font-size:11px;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--bdr);white-space:nowrap}
td{padding:12px 14px;font-size:13px;color:var(--txt2);border-bottom:1px solid #fafafa;white-space:nowrap}
tr:last-child td{border-bottom:none}
td.s{font-weight:600;color:var(--txt)}
td.pr{font:700 14px var(--fn);color:#1e40af}
td.pf{color:var(--grn);font-weight:600}
td.pp{color:var(--amb);font-weight:600}
.tda{display:flex;gap:5px;align-items:center}

/* â”€â”€â”€ CLIENT GRID â”€â”€â”€ */
.cl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}
.cl-card{padding:19px}
.cl-head{display:flex;justify-content:space-between;align-items:flex-start}
.cl-left{display:flex;align-items:center;gap:11px}
.cl-ava{
  width:43px;height:43px;border-radius:12px;
  background:linear-gradient(135deg,#dbeafe,#bfdbfe);
  display:flex;align-items:center;justify-content:center;
}
.cl-nm{font:700 15px var(--fn);color:var(--txt)}
.cl-tp{font-size:12px;color:var(--txt3)}
.cl-info{margin-top:12px;font-size:12px;color:var(--txt2);line-height:1.9}
.cl-note{margin-top:7px;padding:6px 10px;background:#f8fafc;border-radius:8px;font-size:12px;color:var(--txt2)}
.cl-foot{margin-top:10px;padding-top:10px;border-top:1px solid var(--bdr);font-size:11px;color:var(--txt3)}
.cl-btns{display:flex;gap:5px}

/* â”€â”€â”€ KANBAN â”€â”€â”€ */
.kanban{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}
.kb-col{background:#f8fafc;border-radius:14px;padding:15px;border:1px solid var(--bdr)}
.kb-head{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.kb-head .kbt{font:700 14px var(--fn)}
.kb-head .kbc{font-size:11px;font-weight:700;padding:2px 8px;border-radius:12px;border:1px solid}
.kb-cards{display:flex;flex-direction:column;gap:9px}
.kb-card{background:var(--card);border-radius:11px;padding:13px;box-shadow:0 2px 8px rgba(0,0,0,.05);border:1px solid var(--bdr)}
.kb-top{display:flex;justify-content:space-between;align-items:flex-start}
.kb-ttl{font:600 13px var(--fn);color:var(--txt);flex:1;padding-right:6px}
.kb-sub{font-size:11px;color:var(--txt3);margin-top:3px}
.kb-note{font-size:11px;color:var(--txt2);margin-top:5px;font-style:italic}
.kb-act{display:flex;gap:5px;margin-top:9px;flex-wrap:wrap}

/* â”€â”€â”€ CONTRACT â”€â”€â”€ */
.ct-list{display:flex;flex-direction:column;gap:11px}
.ct-item{
  display:flex;align-items:center;gap:17px;padding:17px 20px;
  border-radius:14px;background:var(--card);box-shadow:var(--sh);border:1px solid var(--bdr);
}
.ct-ico{
  width:46px;height:46px;border-radius:12px;flex-shrink:0;
  background:linear-gradient(135deg,#ede9fe,#ddd6fe);
  display:flex;align-items:center;justify-content:center;
}
.ct-info{flex:1}
.ct-info .ci-h{display:flex;align-items:center;gap:9px}
.ct-info .ci-n{font:700 15px var(--fn);color:var(--txt)}
.ct-info .ci-s{font-size:12px;color:var(--txt3);margin-top:2px}
.ct-pr{text-align:right;flex-shrink:0}
.ct-pr .cpm{font:700 16px var(--fn);color:#1e40af}
.ct-pr .cps{font-size:12px;color:var(--txt3)}
.ct-btns{display:flex;gap:5px;flex-shrink:0}

/* â”€â”€â”€ FINANCE â”€â”€â”€ */
.fin-2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.fin-item{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid #fafafa}
.fin-item:last-child{border-bottom:none}
.fin-item .fi-n{font:600 14px var(--fn);color:var(--txt)}
.fin-item .fi-s{font-size:12px;color:var(--txt3)}
.fv{font:700 15px var(--fn)}.fv.pos{color:var(--grn)}.fv.neg{color:var(--red)}
.fin-sep{margin-top:16px;padding-top:13px;border-top:2px solid var(--bdr);font-size:11px;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:.5px}
.cat-tags{display:flex;flex-wrap:wrap;gap:7px;margin-top:8px}
.cat-tag{background:var(--red-l);color:var(--red);padding:3px 10px;border-radius:14px;font-size:12px;font-weight:600}
.cat-tag-inc{background:var(--grn-bg);color:var(--grn);padding:3px 10px;border-radius:14px;font-size:12px;font-weight:600}

/* â”€â”€â”€ MODAL â”€â”€â”€ */
.mo{
  position:fixed;inset:0;background:rgba(0,0,0,.38);
  backdrop-filter:blur(5px);z-index:999;
  display:none;align-items:center;justify-content:center;
}
.mo.on{display:flex}
.mo-box{
  background:#fff;border-radius:16px;width:470px;
  max-height:90vh;overflow-y:auto;padding:30px;
  box-shadow:0 30px 70px rgba(0,0,0,.2);
}
.mo-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:22px}
.mo-hd h3{font-size:19px;font-weight:700;color:var(--txt);margin:0}
.mo-cls{border:none;background:#f1f5f9;border-radius:8px;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.mo-cls:hover{background:var(--bdr2)}

/* form */
.fg{margin-bottom:15px}
.fg label{display:block;font-size:13px;font-weight:600;color:var(--txt2);margin-bottom:5px}
.fg input,.fg select,.fg textarea{
  width:100%;padding:9px 13px;border:1.5px solid var(--bdr2);
  border-radius:10px;font:400 14px var(--fn);background:#fafafa;
  color:var(--txt);outline:none;transition:border .2s;
}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--acc);background:#fff}
.fg textarea{resize:vertical;min-height:60px}
.fr{display:flex;gap:11px}.fr .fg{flex:1}
.f-sub{width:100%;padding:11px;margin-top:6px;font-size:15px}

/* loading overlay */
.load-overlay{
  position:fixed;inset:0;background:rgba(255,255,255,.85);
  z-index:1000;display:none;align-items:center;justify-content:center;flex-direction:column;gap:14px;
}
.load-overlay.on{display:flex}
.load-spinner{
  width:40px;height:40px;border:3px solid var(--bdr2);
  border-top-color:var(--acc);border-radius:50%;
  animation:spin .6s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.load-txt{font:600 14px var(--fn);color:var(--txt2)}

/* toast */
.toast{
  position:fixed;bottom:24px;right:24px;z-index:1001;
  background:var(--txt);color:#fff;padding:12px 20px;border-radius:12px;
  font:500 14px var(--fn);opacity:0;transform:translateY(12px);
  transition:all .3s;pointer-events:none;max-width:320px;
}
.toast.on{opacity:1;transform:translateY(0)}
.toast.success{background:var(--grn)}
.toast.error{background:var(--red)}

/* scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:#94a3b8}

/* anim */
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.pg.on{animation:fadeUp .28s ease}
</style>
</head>
<body>
<div class="app">

<!-- â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â• -->
<aside class="sb">
  <div class="sb-logo">
    <div class="sb-logo-icon">
      <svg width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    </div>
    <div class="sb-logo-txt"><strong>PASOVART</strong><em>FotoÄŸrafÃ§Ä±lÄ±k Paneli</em></div>
  </div>

  <nav class="sb-nav">
    <button class="nav-item active" data-tab="dashboard" onclick="go('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Ana Panel
    </button>
    <button class="nav-item" data-tab="sessions" onclick="go('sessions')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      Ã‡ekimler
    </button>
    <button class="nav-item" data-tab="clients" onclick="go('clients')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="7" r="4"/><path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/><circle cx="17" cy="9" r="2.5"/><path d="M23 21v-1.5a3 3 0 0 0-3-3h-.5"/></svg>
      MÃ¼ÅŸteriler
    </button>
    <button class="nav-item" data-tab="tasks" onclick="go('tasks')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
      GÃ¶revler
    </button>
    <button class="nav-item" data-tab="contracts" onclick="go('contracts')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      SÃ¶zleÅŸmeler
    </button>
    <button class="nav-item" data-tab="finance" onclick="go('finance')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      Gelir / Gider
    </button>
  </nav>

  <div class="sb-footer">
    <span>PASOVART v2.0</span>
    <div class="sb-status">
      <div class="status-dot connecting" id="statusDot"></div>
      <span id="statusTxt">BaÄŸlanÄ±yorâ€¦</span>
    </div>
  </div>
</aside>

<!-- â•â•â•â•â•â• MAIN â•â•â•â•â•â• -->
<div class="main">
  <header class="hdr">
    <div class="hdr-search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" placeholder="Aramaâ€¦" />
    </div>
    <div class="hdr-right">
      <span class="hdr-greet">HoÅŸ geldin, PASOVART ğŸ‘‹</span>
      <div class="hdr-avatar">F</div>
    </div>
  </header>

  <div class="content">
    <div class="pg on" id="pg-dashboard"></div>
    <div class="pg"    id="pg-sessions"></div>
    <div class="pg"    id="pg-clients"></div>
    <div class="pg"    id="pg-tasks"></div>
    <div class="pg"    id="pg-contracts"></div>
    <div class="pg"    id="pg-finance"></div>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â• MODAL â•â•â•â•â•â• -->
<div class="mo" id="mo" onclick="if(event.target===this)closeModal()">
  <div class="mo-box">
    <div class="mo-hd">
      <h3 id="moTitle">â€“</h3>
      <button class="mo-cls" onclick="closeModal()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div id="moBody"></div>
  </div>
</div>

<!-- Loading overlay -->
<div class="load-overlay on" id="loadOverlay">
  <div class="load-spinner"></div>
  <div class="load-txt">Firebase'den veriler yÃ¼kleniyorâ€¦</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script type="module">
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE KONFIGÃœRASYONU
   â”€ Kendi Firebase projeni oluÅŸturduktan sonra
     aÅŸaÄŸÄ±daki placeholder deÄŸerleri gerÃ§ek
     deÄŸerlerinle deÄŸiÅŸtirin.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const firebaseConfig = {
  apiKey: "AIzaSyC82ZVx7sf6evT4zs3b5qoQ6H7eXTrf4Ng",
  authDomain: "pasovartpanel.firebaseapp.com",
  projectId: "pasovartpanel",
  storageBucket: "pasovartpanel.firebasestorage.app",
  messagingSenderId: "1031606727169",
  appId: "1:1031606727169:web:bde71345525d0ec7c90600",
  measurementId: "G-GTR6KPH1CL"
};


/* â•â•â•â•â•â•â• FIREBASE INIT + FALLBACK (modular ESM) â•â•â•â•â•â•â• */
let db = null;
let useFirebase = false;
let _doc, _collection, _setDoc, _deleteDoc, _getDocs;

async function initFirebase() {
  try {
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js');
    const {
      getFirestore,
      doc: docFn,
      collection: colFn,
      setDoc: setDocFn,
      deleteDoc: deleteDocFn,
      getDocs: getDocsFn
    } = await import('https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js');

    const app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    _doc        = docFn;
    _collection = colFn;
    _setDoc     = setDocFn;
    _deleteDoc  = deleteDocFn;
    _getDocs    = getDocsFn;


    useFirebase = true;
    setStatus('online', 'Ã‡evrimiÃ§i');
    await loadAllFromFirebase();
  } catch (e) {
    console.warn('Firebase baÄŸlantÄ± hata:', e);
    useFirebase = false;
    setStatus('offline', 'Ã‡evrimdÄ±ÅŸÄ± (yerel)');
    loadAllFromLocal();
  }
  document.getElementById('loadOverlay').classList.remove('on');
  render('dashboard');
}

function setStatus(state, txt) {
  const dot = document.getElementById('statusDot');
  dot.className = 'status-dot' + (state === 'online' ? '' : state === 'offline' ? ' offline' : ' connecting');
  document.getElementById('statusTxt').textContent = txt;
}

/* â•â•â•â•â•â•â• VERILERI FIREBASE'DEN YÃœKLEME â•â•â•â•â•â•â• */
async function loadAllFromFirebase() {
  clients   = await fbGetAll('clients');
  sessions  = await fbGetAll('sessions');
  contracts = await fbGetAll('contracts');
  tasks     = await fbGetAll('tasks');
  expenses  = await fbGetAll('expenses');
  incomes   = await fbGetAll('incomes');
}

async function fbGetAll(col) {
  try {
    const snap = await _getDocs(_collection(db, col));
    return snap.docs.map(d => ({ ...d.data(), _fbId: d.id }));
  } catch { return []; }
}

/* â•â•â•â•â•â•â• FIREBASE CRUD (modular) â•â•â•â•â•â•â• */
async function fbAdd(col, obj) {
  if (!useFirebase) return obj;
  try {
    const id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now()) + String(Math.random()).slice(2);
    const ref = _doc(db, col, id);
    const { _fbId, ...data } = obj;
    await _setDoc(ref, data);
    obj._fbId = id;
    showToast('Kaydedildi âœ“', 'success');
  } catch (e) { console.warn(e); showToast('Firebase hata â€“ yerel kaydedildi', 'error'); }
  return obj;
}

async function fbUpdate(col, obj) {
  if (!useFirebase || !obj._fbId) return;
  try {
    const { _fbId, ...data } = obj;
    await _setDoc(_doc(db, col, _fbId), data);
    showToast('GÃ¼ncellendi âœ“', 'success');
  } catch (e) { console.warn(e); showToast('GÃ¼ncelleme hata', 'error'); }
}

async function fbDelete(col, fbId) {
  if (!useFirebase || !fbId) return;
  try {
    await _deleteDoc(_doc(db, col, fbId));
    showToast('Silindi âœ“', 'success');
  } catch (e) { console.warn(e); showToast('Silme hata', 'error'); }
}

/* â•â•â•â•â•â•â• LOCAL STORAGE FALLBACK â•â•â•â•â•â•â• */
const ld = (k, fb) => { try { const v = localStorage.getItem('pf_' + k); return v ? JSON.parse(v) : fb; } catch { return fb; } };
const sv = () => {
  if (useFirebase) return; // Firebase varsa local yazmana gerek yok
  try {
    localStorage.setItem('pf_clients', JSON.stringify(clients));
    localStorage.setItem('pf_sessions', JSON.stringify(sessions));
    localStorage.setItem('pf_contracts', JSON.stringify(contracts));
    localStorage.setItem('pf_tasks', JSON.stringify(tasks));
    localStorage.setItem('pf_expenses', JSON.stringify(expenses));
    localStorage.setItem('pf_incomes', JSON.stringify(incomes));
  } catch {}
};

function loadAllFromLocal() {
  clients   = ld('clients', defaultClients);
  sessions  = ld('sessions', defaultSessions);
  contracts = ld('contracts', defaultContracts);
  tasks     = ld('tasks', defaultTasks);
  expenses  = ld('expenses', defaultExpenses);
  incomes   = ld('incomes', defaultIncomes);
}

/* â•â•â•â•â•â•â• DEFAULT DATA â•â•â•â•â•â•â• */
const defaultClients = [
  {id:1,name:"AyÅŸe & Mehmet",type:"DÃ¼ÄŸÃ¼n",phone:"532 123 4567",email:"ayse@email.com",note:"SaÃ§ stilisti ile koordinasyon gerekli"},
  {id:2,name:"Kerem YÄ±lmaz",type:"Kurumsal",phone:"541 987 6543",email:"kerem@firma.com",note:"Logo ile uyumlu renk temalarÄ±"},
  {id:3,name:"Elif Kaya",type:"PortfÃ¶y",phone:"536 111 2222",email:"elif@email.com",note:"Studio Ã§ekimi"},
  {id:4,name:"Can & Deniz",type:"DÃ¼ÄŸÃ¼n",phone:"538 333 4444",email:"can@email.com",note:"AÃ§Ä±k hava ceremony"},
  {id:5,name:"Marta Firma",type:"Kurumsal",phone:"532 555 6666",email:"marta@corp.com",note:"Ekip fotolarÄ± + etkinlik"}
];
const defaultSessions = [
  {id:1,cid:1,date:"2026-02-10",time:"14:00",loc:"Ä°stanbul â€“ Topkapi SarayÄ±",dur:"5 saat",status:"upcoming",pkg:"Premium DÃ¼ÄŸÃ¼n",total:18000,paid:9000},
  {id:2,cid:2,date:"2026-02-08",time:"10:00",loc:"Ankara â€“ Ã‡aÄŸdaÅŸ Sanat Merkezi",dur:"3 saat",status:"upcoming",pkg:"Kurumsal Paket",total:8000,paid:4000},
  {id:3,cid:3,date:"2026-02-05",time:"16:00",loc:"Studio â€“ KarakÃ¶y",dur:"2 saat",status:"done",pkg:"PortfÃ¶y Mini",total:4500,paid:4500},
  {id:4,cid:4,date:"2026-02-18",time:"11:00",loc:"Antalya â€“ KaleiÃ§i",dur:"6 saat",status:"upcoming",pkg:"Premium DÃ¼ÄŸÃ¼n",total:20000,paid:5000},
  {id:5,cid:5,date:"2026-01-28",time:"09:00",loc:"Ä°stanbul â€“ Levent",dur:"4 saat",status:"done",pkg:"Kurumsal Paket",total:10000,paid:10000}
];
const defaultContracts = [
  {id:1,cid:1,sid:1,created:"2026-01-15",status:"signed",terms:"Premium DÃ¼ÄŸÃ¼n paketi. 5 saat Ã§ekim, 150 dÃ¼zenleme. 2 hafta teslim.",total:18000,paid:9000},
  {id:2,cid:2,sid:2,created:"2026-01-20",status:"signed",terms:"Kurumsal ekip fotolarÄ±. 3 saat Ã§ekim, 60 dÃ¼zenleme. 1 hafta teslim.",total:8000,paid:4000},
  {id:3,cid:3,sid:3,created:"2026-01-22",status:"completed",terms:"PortfÃ¶y paketi. 2 saat Ã§ekim, 30 dÃ¼zenleme. 5 gÃ¼n teslim.",total:4500,paid:4500},
  {id:4,cid:4,sid:4,created:"2026-01-25",status:"pending",terms:"Premium DÃ¼ÄŸÃ¼n. 6 saat + etkinlik. 200 dÃ¼zenleme. 3 hafta teslim.",total:20000,paid:5000},
  {id:5,cid:5,sid:5,created:"2026-01-10",status:"completed",terms:"Kurumsal + etkinlik paketi. 4 saat, 80 dÃ¼zenleme.",total:10000,paid:10000}
];
const defaultTasks = [
  {id:1,title:"AyÅŸe & Mehmet â€“ DÃ¼zenleme",cat:"DÃ¼zenleme",status:"inprogress",pri:"high",due:"2026-02-17",sid:1,note:"150 fotoÄŸraf seÃ§ ve dÃ¼zenle"},
  {id:2,title:"Kerem â€“ Kurumsal DÃ¼zenleme",cat:"DÃ¼zenleme",status:"todo",pri:"medium",due:"2026-02-15",sid:2,note:"60 fotoÄŸraf"},
  {id:3,title:"Elif â€“ PortfÃ¶y Teslim",cat:"Teslim",status:"done",pri:"low",due:"2026-02-12",sid:3,note:"Google Drive ile teslim edildi"},
  {id:4,title:"Can & Deniz â€“ Ã–n HazÄ±rlÄ±k",cat:"HazÄ±rlÄ±k",status:"todo",pri:"high",due:"2026-02-16",sid:4,note:"Shot list hazÄ±rla, lokasyon kontrolÃ¼"},
  {id:5,title:"Ekipman BakÄ±m",cat:"BakÄ±m",status:"inprogress",pri:"medium",due:"2026-02-06",sid:null,note:"Lens temizlik + flash kontrolÃ¼"},
  {id:6,title:"Marta â€“ Fatura DÃ¼zenleme",cat:"Mali",status:"done",pri:"low",due:"2026-02-02",sid:5,note:"KDV dahil fatura"}
];
const defaultExpenses = [
  {id:1,date:"2026-01-28",desc:"Lens Tamiri â€“ Sigma",amt:1200,cat:"Ekipman"},
  {id:2,date:"2026-01-30",desc:"Lightroom Abonelik",amt:350,cat:"YazÄ±lÄ±m"},
  {id:3,date:"2026-02-01",desc:"Antalya UÃ§uÅŸ Bileti",amt:920,cat:"UlaÅŸÄ±m"},
  {id:4,date:"2026-02-02",desc:"Antalya Otel (2 gece)",amt:1800,cat:"Konaklama"},
  {id:5,date:"2026-01-25",desc:"KÃ¼Ã§Ã¼k Bellek KartÄ± x5",amt:450,cat:"Ekipman"}
];
const defaultIncomes = [
  {id:1,date:"2026-01-28",desc:"Marta Firma â€“ Kurumsal Paket",amt:10000,cat:"Ã‡ekim Geliri",sid:5},
  {id:2,date:"2026-02-05",desc:"Elif Kaya â€“ PortfÃ¶y Mini",amt:4500,cat:"Ã‡ekim Geliri",sid:3}
];

/* â•â•â•â•â•â•â• RUNTIME STATE â•â•â•â•â•â•â• */
let clients=[], sessions=[], contracts=[], tasks=[], expenses=[], incomes=[];

/* â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â• */
const uid = () => Date.now() + (Math.random() * 9999 | 0);
const cn = id => (clients.find(c => c.id == id) || {}).name || 'â€“';
const fm = n => Number(n).toLocaleString('tr-TR');
const bl = { upcoming:'YaklaÅŸan', done:'TamamlandÄ±', inprogress:'Devam Ediyor', todo:'YapÄ±lacak', signed:'ImzalandÄ±', pending:'Beklemede', completed:'TamamlandÄ±' };
const badge = s => `<span class="badge b-${s}">${bl[s] || s}</span>`;
const pc = p => ({ high:'#ef4444', medium:'#f59e0b', low:'#10b981' }[p] || '#999');

const I = {
  plus:`<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
  trash:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>`,
  edit:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
  chk:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
  bck:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>`,
  fwd:`<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>`,
  usr:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="7" r="4"/><path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/></svg>`,
  doc:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`
};

/* â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â• */
let toastTimer;
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast on ' + type;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('on'), 2400);
}

/* â•â•â•â•â•â•â• TAB SWITCH â•â•â•â•â•â•â• */
let cur = 'dashboard';
function go(k) {
  cur = k;
  document.querySelectorAll('.nav-item').forEach(b => b.classList.toggle('active', b.dataset.tab === k));
  document.querySelectorAll('.pg').forEach(p => p.classList.remove('on'));
  document.getElementById('pg-' + k).classList.add('on');
  render(k);
}

/* â•â•â•â•â•â•â• RENDER ROUTER â•â•â•â•â•â•â• */
function render(k) { document.getElementById('pg-' + k).innerHTML = ({ dashboard: rDash, sessions: rSess, clients: rCli, tasks: rTask, contracts: rCont, finance: rFin })[k](); }

/* â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â• */
function rDash() {
  const inc = incomes.reduce((a, i) => a + i.amt, 0);
  const exp = expenses.reduce((a, e) => a + e.amt, 0);
  const pend = sessions.filter(s => s.status === 'upcoming').reduce((a, s) => a + (s.total - s.paid), 0);
  const up = sessions.filter(s => s.status === 'upcoming').sort((a, b) => new Date(a.date) - new Date(b.date));
  const act = tasks.filter(t => t.status !== 'done');
  return `
  <div class="stat-grid">
    <div class="card stat"><div class="stat-ico" style="background:#ecfdf5"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div><div class="stat-lbl">Toplam Gelir</div><div class="stat-val" style="color:#10b981">â‚º${fm(inc)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#fef2f2"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div><div><div class="stat-lbl">Toplam Gider</div><div class="stat-val" style="color:#ef4444">â‚º${fm(exp)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#eff6ff"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div><div><div class="stat-lbl">Net KazanÃ§</div><div class="stat-val" style="color:#3b82f6">â‚º${fm(inc - exp)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#fffbeb"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div><div class="stat-lbl">Bekleyen Ã–demeler</div><div class="stat-val" style="color:#f59e0b">â‚º${fm(pend)}</div></div></div>
  </div>
  <div class="dash-2">
    <div class="card card-p">
      <div class="ph" style="margin-bottom:14px"><h3 style="font-size:16px;font-weight:700">ğŸ“¸ YaklaÅŸan Ã‡ekimler</h3><span class="badge b-upcoming">${up.length} adet</span></div>
      ${up.map(s => { const d = new Date(s.date); return `<div class="up-item">
        <div class="daybox"><span class="dn">${d.getDate()}</span><span class="dm">${d.toLocaleDateString('tr', { month: 'short' })}</span></div>
        <div class="up-info"><div class="un">${cn(s.cid)}</div><div class="us">${s.pkg} Â· ${s.loc}</div></div>
        <div class="up-price"><div class="upm">â‚º${fm(s.total)}</div><div class="ups">Ã–denen: â‚º${fm(s.paid)}</div></div>
      </div>`; }).join('')}
    </div>
    <div class="card card-p">
      <div class="ph" style="margin-bottom:14px"><h3 style="font-size:16px;font-weight:700">âœ… Aktif GÃ¶revler</h3><span class="badge b-todo">${act.length} bekliyor</span></div>
      ${act.map(t => `<div class="td-item">
        <div class="pdot" style="background:${pc(t.pri)}"></div>
        <div class="td-info"><div class="tn">${t.title}</div><div class="ts">${t.cat} Â· Son: ${t.due}</div></div>
        ${badge(t.status)}
      </div>`).join('')}
    </div>
  </div>`;
}

/* â•â•â•â•â•â•â• SESSIONS â•â•â•â•â•â•â• */
function rSess() {
  return `
  <div class="ph"><h2>ğŸ“· Ã‡ekimler</h2><button class="btn btn-p" onclick="openMo('session')">${I.plus} Yeni Ã‡ekim</button></div>
  <div class="tbl-wrap"><table>
    <thead><tr><th>MÃ¼ÅŸteri</th><th>Tarih & Saat</th><th>Konum</th><th>Paket</th><th>SÃ¼re</th><th>Toplam</th><th>Ã–denen</th><th>Durum</th><th></th></tr></thead>
    <tbody>${sessions.map(s => `<tr>
      <td class="s">${cn(s.cid)}</td><td>${s.date} Â· ${s.time}</td><td>${s.loc}</td><td>${s.pkg}</td><td>${s.dur}</td>
      <td class="pr">â‚º${fm(s.total)}</td><td class="${s.paid === s.total ? 'pf' : 'pp'}">â‚º${fm(s.paid)}</td>
      <td>${badge(s.status)}</td>
      <td class="tda">
        <button class="btn btn-e btn-sm" onclick="openMo('session',${s.id})">${I.edit} DÃ¼zenle</button>
        ${s.status === 'upcoming' ? `<button class="btn btn-g btn-sm" onclick="markDone(${s.id})">${I.chk} Bitti</button>` : ''}
        <button class="btn btn-d btn-sm" onclick="del('session',${s.id})">${I.trash}</button>
      </td>
    </tr>`).join('')}</tbody>
  </table></div>`;
}

/* â•â•â•â•â•â•â• CLIENTS â•â•â•â•â•â•â• */
function rCli() {
  return `
  <div class="ph"><h2>ğŸ‘¤ MÃ¼ÅŸteriler</h2><button class="btn btn-p" onclick="openMo('client')">${I.plus} Yeni MÃ¼ÅŸteri</button></div>
  <div class="cl-grid">${clients.map(c => {
    const cnt = sessions.filter(s => s.cid === c.id).length;
    return `<div class="card cl-card">
      <div class="cl-head"><div class="cl-left"><div class="cl-ava">${I.usr}</div><div><div class="cl-nm">${c.name}</div><div class="cl-tp">${c.type}</div></div></div>
      <div class="cl-btns"><button class="btn btn-e btn-sm" onclick="openMo('client',${c.id})">${I.edit}</button><button class="btn btn-d btn-sm" onclick="del('client',${c.id})">${I.trash}</button></div></div>
      <div class="cl-info">ğŸ“ ${c.phone}<br>âœ‰ï¸ ${c.email}</div>
      ${c.note ? `<div class="cl-note">ğŸ“ ${c.note}</div>` : ''}
      ${cnt ? `<div class="cl-foot">${cnt} Ã§ekim kayÄ±tlÄ±</div>` : ''}
    </div>`;
  }).join('')}</div>`;
}

/* â•â•â•â•â•â•â• TASKS â•â•â•â•â•â•â• */
function rTask() {
  const cols = [{ k: 'todo', l: 'ğŸ“‹ YapÄ±lacak', c: '#7c3aed' }, { k: 'inprogress', l: 'ğŸ”„ Devam Ediyor', c: '#d97706' }, { k: 'done', l: 'âœ… TamamlandÄ±', c: '#16a34a' }];
  return `
  <div class="ph"><h2>ğŸ“Œ GÃ¶revler</h2><button class="btn btn-p" onclick="openMo('task')">${I.plus} Yeni GÃ¶rev</button></div>
  <div class="kanban">${cols.map(col => {
    const its = tasks.filter(t => t.status === col.k);
    return `<div class="kb-col">
      <div class="kb-head"><span class="kbt" style="color:${col.c}">${col.l}</span><span class="kbc" style="color:${col.c};border-color:${col.c}44;background:${col.c}0d">${its.length}</span></div>
      <div class="kb-cards">${its.map(t => `<div class="kb-card">
        <div class="kb-top"><span class="kb-ttl">${t.title}</span><div class="pdot" style="background:${pc(t.pri)};margin-top:3px" title="${{ high: 'YÃ¼ksek', medium: 'Orta', low: 'DÃ¼ÅŸÃ¼k' }[t.pri]}"></div></div>
        <div class="kb-sub">${t.cat} Â· Son: ${t.due}</div>
        ${t.note ? `<div class="kb-note">${t.note}</div>` : ''}
        <div class="kb-act">
          <button class="btn btn-e btn-sm" onclick="openMo('task',${t.id})">${I.edit} DÃ¼zenle</button>
          ${col.k !== 'todo' ? `<button class="btn btn-g btn-sm" onclick="mvTask(${t.id},'todo')">${I.bck} Geri</button>` : ''}
          ${col.k !== 'done' ? `<button class="btn btn-g btn-sm" onclick="mvTask(${t.id},'${col.k === 'todo' ? 'inprogress' : 'done'}')">${I.fwd} Ä°leri</button>` : ''}
          <button class="btn btn-d btn-sm" style="margin-left:auto" onclick="del('task',${t.id})">${I.trash}</button>
        </div>
      </div>`).join('')}</div>
    </div>`;
  }).join('')}</div>`;
}

/* â•â•â•â•â•â•â• CONTRACTS â•â•â•â•â•â•â• */
function rCont() {
  return `
  <div class="ph"><h2>ğŸ“„ SÃ¶zleÅŸmeler</h2><button class="btn btn-p" onclick="openMo('contract')">${I.plus} Yeni SÃ¶zleÅŸme</button></div>
  <div class="ct-list">${contracts.map(c => `<div class="ct-item">
    <div class="ct-ico">${I.doc}</div>
    <div class="ct-info"><div class="ci-h"><span class="ci-n">${cn(c.cid)}</span>${badge(c.status)}</div><div class="ci-s">OluÅŸ: ${c.created} Â· ${c.terms.slice(0, 70)}â€¦</div></div>
    <div class="ct-pr"><div class="cpm">â‚º${fm(c.total)}</div><div class="cps">Ã–denen: â‚º${fm(c.paid)}</div></div>
    <div class="ct-btns">
      <button class="btn btn-e btn-sm" onclick="openMo('contract',${c.id})">${I.edit} DÃ¼zenle</button>
      <button class="btn btn-d btn-sm" onclick="del('contract',${c.id})">${I.trash}</button>
    </div>
  </div>`).join('')}</div>`;
}

/* â•â•â•â•â•â•â• FINANCE â•â•â•â•â•â•â• */
function rFin() {
  const inc = incomes.reduce((a, i) => a + i.amt, 0);
  const exp = expenses.reduce((a, e) => a + e.amt, 0);
  const catExp = {}, catInc = {};
  expenses.forEach(e => { catExp[e.cat] = (catExp[e.cat] || 0) + e.amt; });
  incomes.forEach(i => { catInc[i.cat] = (catInc[i.cat] || 0) + i.amt; });
  return `
  <div class="ph"><h2>ğŸ’° Gelir / Gider</h2><div style="display:flex;gap:8px"><button class="btn btn-p" onclick="openMo('income')">${I.plus} Gelir Ekle</button><button class="btn btn-p" style="background:linear-gradient(135deg,#dc2626,#ef4444);box-shadow:0 2px 8px rgba(239,68,68,.3)" onclick="openMo('expense')">${I.plus} Gider Ekle</button></div></div>
  <div class="stat-grid" style="grid-template-columns:repeat(3,1fr)">
    <div class="card stat"><div class="stat-ico" style="background:#ecfdf5"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg></div><div><div class="stat-lbl">Toplam Gelir</div><div class="stat-val" style="color:#10b981">â‚º${fm(inc)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#fef2f2"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div><div><div class="stat-lbl">Toplam Gider</div><div class="stat-val" style="color:#ef4444">â‚º${fm(exp)}</div></div></div>
    <div class="card stat"><div class="stat-ico" style="background:#eff6ff"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div><div class="stat-lbl">Net KazanÃ§</div><div class="stat-val" style="color:#3b82f6">â‚º${fm(inc - exp)}</div></div></div>
  </div>
  <div class="fin-2">
    <div class="card card-p">
      <div class="ph" style="margin-bottom:14px"><h3 style="font-size:15px;font-weight:700;color:#10b981">ğŸ“ˆ Gelir KaynaklarÄ±</h3></div>
      ${incomes.map(i => `<div class="fin-item">
        <div><div class="fi-n">${i.desc}</div><div class="fi-s">${i.cat} Â· ${i.date}</div></div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="fv pos">+â‚º${fm(i.amt)}</span>
          <button class="btn btn-e btn-sm" onclick="openMo('income',${i.id})">${I.edit}</button>
          <button class="btn btn-d btn-sm" onclick="del('income',${i.id})">${I.trash}</button>
        </div>
      </div>`).join('')}
      <div class="fin-sep">Kategori Ã–zeti</div>
      <div class="cat-tags">${Object.entries(catInc).map(([k, v]) => `<span class="cat-tag-inc">${k}: â‚º${fm(v)}</span>`).join('')}</div>
    </div>
    <div class="card card-p">
      <div class="ph" style="margin-bottom:14px"><h3 style="font-size:15px;font-weight:700;color:#ef4444">ğŸ“‰ Giderler</h3></div>
      ${expenses.map(e => `<div class="fin-item">
        <div><div class="fi-n">${e.desc}</div><div class="fi-s">${e.cat} Â· ${e.date}</div></div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="fv neg">-â‚º${fm(e.amt)}</span>
          <button class="btn btn-e btn-sm" onclick="openMo('expense',${e.id})">${I.edit}</button>
          <button class="btn btn-d btn-sm" onclick="del('expense',${e.id})">${I.trash}</button>
        </div>
      </div>`).join('')}
      <div class="fin-sep">Kategori Ã–zeti</div>
      <div class="cat-tags">${Object.entries(catExp).map(([k, v]) => `<span class="cat-tag">${k}: â‚º${fm(v)}</span>`).join('')}</div>
    </div>
  </div>`;
}

/* â•â•â•â•â•â•â• ACTIONS â•â•â•â•â•â•â• */
async function markDone(id) {
  const s = sessions.find(x => x.id === id);
  if (s) { s.status = 'done'; s.paid = s.total; }
  await persistOne('sessions', s);
  // otomatik gelir kayÄ±t
  const alreadyIn = incomes.find(i => i.sid === id);
  if (!alreadyIn) {
    const inc = { id: uid(), date: s.date, desc: `${cn(s.cid)} â€“ ${s.pkg}`, amt: s.total, cat: 'Ã‡ekim Geliri', sid: id };
    incomes.push(inc);
    await persistOne('incomes', inc, true);
  }
  render(cur);
}

async function mvTask(id, ns) {
  const t = tasks.find(x => x.id === id);
  if (t) t.status = ns;
  await persistOne('tasks', t);
  render(cur);
}

async function del(type, id) {
  const map = { session: 'sessions', client: 'clients', task: 'tasks', contract: 'contracts', expense: 'expenses', income: 'incomes' };
  const col = map[type];
  const item = eval(col).find(x => x.id === id);
  const fbId = item ? item._fbId : null;
  eval(col + '=' + col + '.filter(x=>x.id!==' + id + ')');
  if (useFirebase && fbId) await fbDelete(col, fbId);
  else sv();
  if (!useFirebase) showToast('Silindi âœ“', 'success');
  render(cur);
}

/* persist one item: update if exists, add if new */
async function persistOne(col, obj, isNew = false) {
  if (useFirebase) {
    if (isNew || !obj._fbId) await fbAdd(col, obj);
    else await fbUpdate(col, obj);
  } else { sv(); showToast('Kaydedildi âœ“', 'success'); }
}

/* â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â• */
const moTitles = {
  session: 'Yeni Ã‡ekim Ekle', client: 'Yeni MÃ¼ÅŸteri Ekle',
  task: 'Yeni GÃ¶rev Ekle', contract: 'Yeni SÃ¶zleÅŸme Ekle',
  expense: 'Yeni Gider Ekle', income: 'Yeni Gelir Ekle'
};

let _moType = '', _moId = null;

function openMo(type, editId) {
  _moType = type; _moId = editId || null;
  const isEdit = !!editId;
  document.getElementById('moTitle').textContent = isEdit ? 'DÃ¼zenle' : moTitles[type];
  document.getElementById('moBody').innerHTML = moForms[type](editId);
  document.getElementById('mo').classList.add('on');
}
function closeModal() { document.getElementById('mo').classList.remove('on'); }
const v = id => (document.getElementById(id) || {}).value || '';

/* â•â•â•â•â•â•â• MODAL FORMS (add & edit) â•â•â•â•â•â•â• */
const moForms = {
  session: (editId) => {
    const o = editId ? sessions.find(s => s.id === editId) : {};
    return `
      <div class="fg"><label>MÃ¼ÅŸteri</label><select id="f_cid"><option value="">SeÃ§â€¦</option>${clients.map(c => `<option value="${c.id}" ${o.cid == c.id ? 'selected' : ''}>${c.name}</option>`).join('')}</select></div>
      <div class="fr"><div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date || ''}"/></div><div class="fg"><label>Saat</label><input type="time" id="f_time" value="${o.time || ''}"/></div></div>
      <div class="fg"><label>Konum</label><input type="text" id="f_loc" placeholder="Ã‡ekim lokasyonu" value="${o.loc || ''}"/></div>
      <div class="fr">
        <div class="fg"><label>SÃ¼re</label><select id="f_dur">${['1 saat','2 saat','3 saat','4 saat','5 saat','6 saat'].map(d => `<option ${o.dur === d ? 'selected' : ''}>${d}</option>`).join('')}</select></div>
        <div class="fg"><label>Paket</label><select id="f_pkg">${['Standard','Premium DÃ¼ÄŸÃ¼n','Kurumsal Paket','PortfÃ¶y Mini','Ã–zel'].map(p => `<option ${o.pkg === p ? 'selected' : ''}>${p}</option>`).join('')}</select></div>
      </div>
      <div class="fr"><div class="fg"><label>Toplam Fiyat (â‚º)</label><input type="number" id="f_total" placeholder="0" value="${o.total || ''}"/></div><div class="fg"><label>Ã–denen (â‚º)</label><input type="number" id="f_paid" placeholder="0" value="${o.paid || ''}"/></div></div>
      ${editId ? `<div class="fg"><label>Durum</label><select id="f_status"><option value="upcoming" ${o.status === 'upcoming' ? 'selected' : ''}>YaklaÅŸan</option><option value="done" ${o.status === 'done' ? 'selected' : ''}>TamamlandÄ±</option></select></div>` : ''}
      <button class="btn btn-p f-sub" onclick="subSession(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'Ã‡ekim Ekle'}</button>`;
  },

  client: (editId) => {
    const o = editId ? clients.find(c => c.id === editId) : {};
    return `
      <div class="fg"><label>Ad Soyad</label><input type="text" id="f_name" placeholder="MÃ¼ÅŸteri adÄ±" value="${o.name || ''}"/></div>
      <div class="fg"><label>TÃ¼rÃ¼</label><select id="f_type">${['DÃ¼ÄŸÃ¼n','Kurumsal','PortfÃ¶y','Etkinlik','DiÄŸer'].map(t => `<option ${o.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div>
      <div class="fr"><div class="fg"><label>Telefon</label><input type="text" id="f_phone" placeholder="532 xxx xxxx" value="${o.phone || ''}"/></div><div class="fg"><label>Email</label><input type="email" id="f_email" placeholder="email@â€¦" value="${o.email || ''}"/></div></div>
      <div class="fg"><label>Not</label><textarea id="f_note" placeholder="Ek bilgiâ€¦">${o.note || ''}</textarea></div>
      <button class="btn btn-p f-sub" onclick="subClient(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'MÃ¼ÅŸteri Ekle'}</button>`;
  },

  task: (editId) => {
    const o = editId ? tasks.find(t => t.id === editId) : {};
    return `
      <div class="fg"><label>GÃ¶rev AdÄ±</label><input type="text" id="f_title" placeholder="Ne yapÄ±lacak?" value="${o.title || ''}"/></div>
      <div class="fr">
        <div class="fg"><label>Kategori</label><select id="f_cat">${['DÃ¼zenleme','Teslim','HazÄ±rlÄ±k','Mali','BakÄ±m','DiÄŸer'].map(c => `<option ${o.cat === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div>
        <div class="fg"><label>Ã–ncelik</label><select id="f_pri">${[['high','YÃ¼ksek'],['medium','Orta'],['low','DÃ¼ÅŸÃ¼k']].map(([v, l]) => `<option value="${v}" ${o.pri === v ? 'selected' : ''}>${l}</option>`).join('')}</select></div>
      </div>
      <div class="fg"><label>Son Tarih</label><input type="date" id="f_due" value="${o.due || ''}"/></div>
      <div class="fg"><label>Ä°lgili Ã‡ekim</label><select id="f_sid"><option value="" ${!o.sid ? 'selected' : ''}>Yok</option>${sessions.map(s => `<option value="${s.id}" ${o.sid == s.id ? 'selected' : ''}>${cn(s.cid)} â€“ ${s.date}</option>`).join('')}</select></div>
      <div class="fg"><label>Not</label><textarea id="f_note" placeholder="Detayâ€¦">${o.note || ''}</textarea></div>
      ${editId ? `<div class="fg"><label>Durum</label><select id="f_tstatus"><option value="todo" ${o.status === 'todo' ? 'selected' : ''}>YapÄ±lacak</option><option value="inprogress" ${o.status === 'inprogress' ? 'selected' : ''}>Devam Ediyor</option><option value="done" ${o.status === 'done' ? 'selected' : ''}>TamamlandÄ±</option></select></div>` : ''}
      <button class="btn btn-p f-sub" onclick="subTask(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'GÃ¶rev Ekle'}</button>`;
  },

  contract: (editId) => {
    const o = editId ? contracts.find(c => c.id === editId) : {};
    return `
      <div class="fg"><label>MÃ¼ÅŸteri</label><select id="f_cid"><option value="">SeÃ§â€¦</option>${clients.map(c => `<option value="${c.id}" ${o.cid == c.id ? 'selected' : ''}>${c.name}</option>`).join('')}</select></div>
      <div class="fg"><label>Ä°lgili Ã‡ekim</label><select id="f_sid"><option value="" ${!o.sid ? 'selected' : ''}>Yok</option>${sessions.map(s => `<option value="${s.id}" ${o.sid == s.id ? 'selected' : ''}>${cn(s.cid)} â€“ ${s.date}</option>`).join('')}</select></div>
      <div class="fg"><label>Durum</label><select id="f_st"><option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Beklemede</option><option value="signed" ${o.status === 'signed' ? 'selected' : ''}>ImzalandÄ±</option><option value="completed" ${o.status === 'completed' ? 'selected' : ''}>TamamlandÄ±</option></select></div>
      <div class="fg"><label>Åartlar & KoÅŸullar</label><textarea id="f_terms" placeholder="SÃ¶zleÅŸme maddelerâ€¦">${o.terms || ''}</textarea></div>
      <div class="fr"><div class="fg"><label>Toplam Fiyat (â‚º)</label><input type="number" id="f_total" placeholder="0" value="${o.total || ''}"/></div><div class="fg"><label>Ã–denen (â‚º)</label><input type="number" id="f_paid" placeholder="0" value="${o.paid || ''}"/></div></div>
      <button class="btn btn-p f-sub" onclick="subContract(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'SÃ¶zleÅŸme Ekle'}</button>`;
  },

  expense: (editId) => {
    const o = editId ? expenses.find(e => e.id === editId) : {};
    return `
      <div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date || ''}"/></div>
      <div class="fg"><label>AÃ§Ä±klama</label><input type="text" id="f_desc" placeholder="Ne iÃ§in?" value="${o.desc || ''}"/></div>
      <div class="fr"><div class="fg"><label>Tutar (â‚º)</label><input type="number" id="f_amt" placeholder="0" value="${o.amt || ''}"/></div><div class="fg"><label>Kategori</label><select id="f_cat">${['Ekipman','YazÄ±lÄ±m','UlaÅŸÄ±m','Konaklama','Pazarlama','DiÄŸer'].map(c => `<option ${o.cat === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div></div>
      <button class="btn btn-p f-sub" onclick="subExpense(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'Gider Ekle'}</button>`;
  },

  income: (editId) => {
    const o = editId ? incomes.find(i => i.id === editId) : {};
    return `
      <div class="fg"><label>Tarih</label><input type="date" id="f_date" value="${o.date || ''}"/></div>
      <div class="fg"><label>AÃ§Ä±klama</label><input type="text" id="f_desc" placeholder="Gelir kaynaÄŸÄ±" value="${o.desc || ''}"/></div>
      <div class="fr"><div class="fg"><label>Tutar (â‚º)</label><input type="number" id="f_amt" placeholder="0" value="${o.amt || ''}"/></div><div class="fg"><label>Kategori</label><select id="f_cat">${['Ã‡ekim Geliri','DÃ¼zenleme Geliri','DanÄ±ÅŸmanlÄ±k','DiÄŸer'].map(c => `<option ${o.cat === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div></div>
      <div class="fg"><label>Ä°lgili Ã‡ekim (isteÄŸe baÄŸlÄ±)</label><select id="f_sid"><option value="" ${!o.sid ? 'selected' : ''}>Yok</option>${sessions.map(s => `<option value="${s.id}" ${o.sid == s.id ? 'selected' : ''}>${cn(s.cid)} â€“ ${s.date}</option>`).join('')}</select></div>
      <button class="btn btn-p f-sub" onclick="subIncome(${editId || 0})">${editId ? 'GÃ¼ncelle' : 'Gelir Ekle'}</button>`;
  }
};

/* â•â•â•â•â•â•â• SUBMIT HANDLERS (add / edit) â•â•â•â•â•â•â• */
async function subSession(editId) {
  if (!v('f_cid')) return;
  if (editId) {
    const s = sessions.find(x => x.id === editId);
    Object.assign(s, { cid: Number(v('f_cid')), date: v('f_date'), time: v('f_time'), loc: v('f_loc'), dur: v('f_dur'), pkg: v('f_pkg'), total: Number(v('f_total')) || 0, paid: Number(v('f_paid')) || 0, status: v('f_status') || s.status });
    await persistOne('sessions', s);
  } else {
    const obj = { id: uid(), cid: Number(v('f_cid')), date: v('f_date'), time: v('f_time'), loc: v('f_loc'), dur: v('f_dur'), status: 'upcoming', pkg: v('f_pkg'), total: Number(v('f_total')) || 0, paid: Number(v('f_paid')) || 0 };
    sessions.push(obj);
    await persistOne('sessions', obj, true);
  }
  closeModal(); render('sessions');
}

async function subClient(editId) {
  if (!v('f_name')) return;
  if (editId) {
    const c = clients.find(x => x.id === editId);
    Object.assign(c, { name: v('f_name'), type: v('f_type'), phone: v('f_phone'), email: v('f_email'), note: v('f_note') });
    await persistOne('clients', c);
  } else {
    const obj = { id: uid(), name: v('f_name'), type: v('f_type'), phone: v('f_phone'), email: v('f_email'), note: v('f_note') };
    clients.push(obj);
    await persistOne('clients', obj, true);
  }
  closeModal(); render('clients');
}

async function subTask(editId) {
  if (!v('f_title')) return;
  if (editId) {
    const t = tasks.find(x => x.id === editId);
    Object.assign(t, { title: v('f_title'), cat: v('f_cat'), pri: v('f_pri'), due: v('f_due'), sid: v('f_sid') || null, note: v('f_note'), status: v('f_tstatus') || t.status });
    await persistOne('tasks', t);
  } else {
    const obj = { id: uid(), title: v('f_title'), cat: v('f_cat'), status: 'todo', pri: v('f_pri'), due: v('f_due'), sid: v('f_sid') || null, note: v('f_note') };
    tasks.push(obj);
    await persistOne('tasks', obj, true);
  }
  closeModal(); render('tasks');
}

async function subContract(editId) {
  if (!v('f_cid')) return;
  if (editId) {
    const c = contracts.find(x => x.id === editId);
    Object.assign(c, { cid: Number(v('f_cid')), sid: v('f_sid') || null, status: v('f_st'), terms: v('f_terms'), total: Number(v('f_total')) || 0, paid: Number(v('f_paid')) || 0 });
    await persistOne('contracts', c);
  } else {
    const obj = { id: uid(), cid: Number(v('f_cid')), sid: v('f_sid') || null, created: new Date().toISOString().slice(0, 10), status: v('f_st'), terms: v('f_terms'), total: Number(v('f_total')) || 0, paid: Number(v('f_paid')) || 0 };
    contracts.push(obj);
    await persistOne('contracts', obj, true);
  }
  closeModal(); render('contracts');
}

async function subExpense(editId) {
  if (!v('f_desc') || !v('f_amt')) return;
  if (editId) {
    const e = expenses.find(x => x.id === editId);
    Object.assign(e, { date: v('f_date'), desc: v('f_desc'), amt: Number(v('f_amt')), cat: v('f_cat') });
    await persistOne('expenses', e);
  } else {
    const obj = { id: uid(), date: v('f_date'), desc: v('f_desc'), amt: Number(v('f_amt')), cat: v('f_cat') };
    expenses.push(obj);
    await persistOne('expenses', obj, true);
  }
  closeModal(); render('finance');
}

async function subIncome(editId) {
  if (!v('f_desc') || !v('f_amt')) return;
  if (editId) {
    const i = incomes.find(x => x.id === editId);
    Object.assign(i, { date: v('f_date'), desc: v('f_desc'), amt: Number(v('f_amt')), cat: v('f_cat'), sid: v('f_sid') || null });
    await persistOne('incomes', i);
  } else {
    const obj = { id: uid(), date: v('f_date'), desc: v('f_desc'), amt: Number(v('f_amt')), cat: v('f_cat'), sid: v('f_sid') || null };
    incomes.push(obj);
    await persistOne('incomes', obj, true);
  }
  closeModal(); render('finance');
}

/* â•â•â•â•â•â•â• BOOT â•â•â•â•â•â•â• */
initFirebase();
</script>
</body>
</html>
